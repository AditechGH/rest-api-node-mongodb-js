{"code":"module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=12)}([function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const n={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\"},i={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},o={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\"},a={PORT:process.env.PORT||3e3};t.default={...a,...function(e){switch(e){case\"development\":return n;case\"test\":return i;default:return o}}(\"production\")}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.authJwt=t.authLocal=void 0;var n=u(r(4)),i=u(r(29)),o=r(30),a=r(8);function u(e){return e&&e.__esModule?e:{default:e}}const s=new i.default({usernameField:\"email\"},async(e,t,r)=>{try{const n=await(0,a.fetchOne)({email:e});return n&&n.authenticateUser(t)?r(null,n):r(null,!1)}catch(e){return r(e,!1)}}),d={jwtFromRequest:o.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:\"JWT_SECRET\"},l=new o.Strategy(d,async(e,t)=>{try{const r=await(0,a.fetchOne)({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});n.default.use(s),n.default.use(l);t.authLocal=n.default.authenticate(\"local\",{session:!1}),t.authJwt=n.default.authenticate(\"jwt\",{session:!1})},function(e,t){e.exports=require(\"passport\")},,function(e,t){e.exports=require(\"bcrypt-nodejs\")},,function(e,t,r){\"use strict\";const n=r(9).default,i=r(27)().get_ip;t.save=(async e=>{try{const t=new n(e);return await t.save()}catch(e){throw Error(e)}}),t.fetch=(async(e,t,r)=>{try{return await n.paginate(e,{page:t,limit:r,sort:{_id:\"asc\"}})}catch(e){throw Error(\"Error while paginating admins\")}}),t.fetchOne=(async e=>{try{return await n.findOne(e)}catch(e){throw Error(\"Error fetching admin\")}}),t.update=(async(e,t)=>{try{return await n.updateOne(e,{$set:t})}catch(e){throw Error(\"Error editing admin\")}}),t.delete=(async e=>{try{return await n.deleteOne(e)}catch(e){throw Error(\"Error deleting admin\")}}),t.getIP=(e=>{return i(e).clientIp})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=l(r(0)),i=l(r(22)),o=l(r(23)),a=l(r(6)),u=l(r(24)),s=l(r(2)),d=l(r(10));function l(e){return e&&e.__esModule?e:{default:e}}const c=n.default.Schema({name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>i.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:n.default.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});c.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),c.methods={_hashPassword:e=>a.default.hashSync(e),authenticateUser(e){return a.default.compareSync(e,this.password)},createToken(){return u.default.sign({_id:this._id},s.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,password:this.password,type:this.type,ip:this.ip,signup:this.signup,lastlogin:this.lastlogin,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(e){return this.favorites.posts.indexOf(e)>=0?(this.favorites.posts.remove(e),await d.default.decFavoriteCount(e)):(this.favorites.posts.push(e),await d.default.incFavoriteCount(e)),this.save()},isPostIsFavorite(e){return this.favorites.posts.indexOf(e)>=0}}},c.plugin(o.default),t.default=n.default.model(\"Admin\",c)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=a(r(0)),i=a(r(25)),o=a(r(26));function a(e){return e&&e.__esModule?e:{default:e}}const u=n.default.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:n.default.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});u.plugin(o.default,{message:\"{VALUE} already taken!\"}),u.pre(\"validate\",function(e){this._slugify(),e()}),u.methods={_slugify(){this.slug=(0,i.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},u.statics={createPost(e,t){return this.create({...e,user:t})},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate(\"user\")},incFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:1}})},decFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:-1}})}},t.default=n.default.model(\"Post\",u)},,function(e,t,r){\"use strict\";var n=u(r(1)),i=u(r(2));r(13);var o=u(r(14)),a=u(r(19));function u(e){return e&&e.__esModule?e:{default:e}}const s=(0,n.default)();(0,o.default)(s),s.get(\"/\",(e,t)=>{t.send(\"Hello world!\")}),(0,a.default)(s),s.listen(i.default.PORT,e=>{if(e)throw e;console.log(`Server running on port: ${i.default.PORT}\\n\\n    -- - Running on production`)})},function(e,t,r){\"use strict\";var n=o(r(0)),i=o(r(2));function o(e){return e&&e.__esModule?e:{default:e}}n.default.Promise=global.Promise;try{n.default.connect(i.default.MONGO_URL)}catch(e){n.default.createConnection(i.default.MONGO_URL)}n.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});u(r(15));var n=r(16),i=u(r(17)),o=u(r(18)),a=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use((0,i.default)()),e.use((0,o.default)()),e.use((0,n.json)()),e.use((0,n.urlencoded)({extended:!0})),e.use(a.default.initialize())})},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"helmet\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};t.default=(e=>{e.get(\"/hello\",o.default,(e,t)=>{t.send(\"This is a private route!!!!\")})})},,,function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"mongoose-paginate\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"slug\")},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t){e.exports=require(\"ipware\")},,function(e,t){e.exports=require(\"passport-local\")},function(e,t){e.exports=require(\"passport-jwt\")}]);","extractedComments":[]}