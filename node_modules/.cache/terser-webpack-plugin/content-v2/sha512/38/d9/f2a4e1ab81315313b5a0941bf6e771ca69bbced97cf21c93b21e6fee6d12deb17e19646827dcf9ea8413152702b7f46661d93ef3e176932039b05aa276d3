{"code":"module.exports=function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=25)}([function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const s={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\",url:\"http://localhost:3000\"},n={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},a={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\",url:\"http://52.14.168.100:3000\"},i={PORT:process.env.PORT||3e3,twilio:{number:\"+12057429662\",accountSid:\"AC8a5fea6fb2f049b05bcbf3eaf330c38d\",authToken:\"b7bd7d0c620a0342b8a16bd0dfefde88\",authyKey:\"eXzYv8A8y5pn6q8W2taH67zBqhqsDtug\"},no_reply:\"no_reply@halalclothingonline.com\",amazon:{AccessKeyID:\"AKIAJRZ5NEHVHRBCCRQA\",SecretAccessKey:\"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\",region:\"us-east-1\"}};t.default={...i,...function(e){switch(e){case\"development\":return s;case\"test\":return n;default:return a}}(\"production\")}},function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"passport\")},function(e,t){e.exports=require(\"express-validation\")},function(e,t){e.exports=require(\"bcrypt-nodejs\")},function(e,t){e.exports=require(\"http-status\")},function(e,t){e.exports=require(\"joi\")},function(e,t){e.exports=require(\"mongoose-paginate\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t){e.exports=require(\"passport-local\")},function(e,t){e.exports=require(\"passport-jwt\")},function(e,t,r){\"use strict\";const s=r(14).default,n=r(40)().get_ip;t.save=(async e=>{try{const t=new s(e);return await t.save()}catch(e){throw Error(e)}}),t.fetch=(async(e,t,r)=>{try{return await s.paginate(e,{page:t,limit:r,sort:{_id:\"asc\"}})}catch(e){throw Error(\"Error while paginating admins\")}}),t.fetchOne=(async e=>{try{return await s.findOne(e)}catch(e){throw Error(\"Error fetching admin\")}}),t.update=(async(e,t)=>{try{return await s.updateOne(e,{$set:t})}catch(e){throw Error(\"Error editing admin\")}}),t.delete=(async e=>{try{return await s.deleteOne(e)}catch(e){throw Error(\"Error deleting admin\")}}),t.getIP=(e=>{return n(e).clientIp})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=l(r(1)),n=l(r(38)),a=l(r(8)),i=l(r(5)),o=l(r(9)),d=l(r(0)),u=l(r(15));function l(e){return e&&e.__esModule?e:{default:e}}const c=s.default.Schema({name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>n.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:s.default.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});c.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),c.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return o.default.sign({_id:this._id,type:\"admin\"},d.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,type:this.type,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(e){return this.favorites.posts.indexOf(e)>=0?(this.favorites.posts.remove(e),await u.default.decFavoriteCount(e)):(this.favorites.posts.push(e),await u.default.incFavoriteCount(e)),this.save()},isPostIsFavorite(e){return this.favorites.posts.indexOf(e)>=0}}},c.plugin(a.default),t.default=s.default.model(\"Admin\",c)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=i(r(1)),n=i(r(39)),a=i(r(10));function i(e){return e&&e.__esModule?e:{default:e}}const o=s.default.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:s.default.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});o.plugin(a.default,{message:\"{VALUE} already taken!\"}),o.pre(\"validate\",function(e){this._slugify(),e()}),o.methods={_slugify(){this.slug=(0,n.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},o.statics={createPost(e,t){return this.create({...e,user:t})},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate(\"user\")},incFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:1}})},decFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:-1}})}},t.default=s.default.model(\"Post\",o)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.authJwt=t.authLocal=void 0;var s=d(r(3)),n=d(r(11)),a=r(12),i=r(13),o=d(r(0));function d(e){return e&&e.__esModule?e:{default:e}}const u=new n.default({usernameField:\"email\"},async(e,t,r)=>{try{const s=await(0,i.fetchOne)({email:e});return s&&s.authenticateUser(t)?r(null,s):r(null,!1)}catch(e){return r(e,!1)}}),l={jwtFromRequest:a.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:o.default.JWT_SECRET},c=new a.Strategy(l,async(e,t)=>{try{const r=await(0,i.fetchOne)({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});s.default.use(u),s.default.use(c);t.authLocal=s.default.authenticate(\"local\",{session:!1}),t.authJwt=s.default.authenticate(\"jwt\",{session:!1})},function(e,t){e.exports=require(\"crypto\")},function(e,t,r){\"use strict\";var s=c(r(1)),n=c(r(8)),a=c(r(10)),i=c(r(5)),o=c(r(9)),d=c(r(19)),u=c(r(20)),l=c(r(0));function c(e){return e&&e.__esModule?e:{default:e}}const p=r(21)(l.default.twilio.authyKey),f=(0,u.default)(l.default.twilio.accountSid,l.default.twilio.authToken),y=s.default.Schema({fullName:{type:String,required:[!0,\"fullName is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0},password:{type:String,required:[!0,\"Password is required!\"],trim:!0,minlength:[4,\"Password need to be longer!\"]},phone:{type:String,unique:!0,required:[!0,\"Phone Number is required!\"],trim:!0},countryCode:{type:String,required:[!0,\"countryCode is required!\"],trim:!0},authyId:String,verified:{type:Boolean,default:!1},ip:String,resetPassword:{token:String,expire:Date},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},location:{type:String,required:!1,trim:!0},deviceToken:{type:String,required:!1,trim:!0},avatar:{},facebook:{id:{type:String,required:!1,trim:!0},token:{type:String,required:!1,trim:!0},fullname:{type:String,required:!1,trim:!0},avatar:{},expiration_date:{}},google:{token:{type:String,required:!1,trim:!0},fullname:{type:String,required:!1,trim:!0},email:{type:String,required:!1,trim:!0},avatar:{},expiration_date:{}}});y.pre(\"save\",async function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),this.ip||(this.ip=await this.getIP()),e()}),y.plugin(a.default,{message:\"{VALUE} already taken!\"}),y.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return o.default.sign({_id:this._id},l.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,facebook:this.facebook,google:this.google,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,facebook:this.facebook,google:this.google,avatar:this.avatar}},_login:{async save(){return this.ip=await this.getIP(),this.lastlogin=new Date,await this.save()}},getIP:()=>d.default.v4(),verifyAuthyToken(e){return new Promise((t,r)=>{p.verify(this.authyId,e,(e,s)=>{e&&r(e),s&&t(s)})})},sendAuthyToken(){return new Promise((e,t)=>{function r(r){p.request_sms(r,!0,(r,s)=>{r&&t(r),s&&e(s)})}this.authyId?r(this.authyId):p.register_user(this.email,this.phone,this.countryCode,async(e,s)=>{e&&t(e),this.authyId=s.user.id,await this.save(),r(this.authyId)})})},async sendMessage(e){return await f.sendMessage({to:`+${this.countryCode}${this.phone}`,from:l.default.twillio.number,body:e})}},y.plugin(n.default),e.exports=s.default.model(\"User\",y)},function(e,t){e.exports=require(\"public-ip\")},function(e,t){e.exports=require(\"twilio\")},function(e,t){e.exports=require(\"authy\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){s.default.config.update({accessKeyId:n.default.amazon.AccessKeyID,secretAccessKey:n.default.amazon.SecretAccessKey,region:n.default.amazon.region});const t=new s.default.SES({apiVersion:\"latest\"});return new Promise((r,s)=>{t.sendEmail({Source:e.from,Destination:{CcAddresses:e.cc,ToAddresses:e.to},Message:{Subject:{Data:e.subject},Body:{Html:{Data:e.body}}},ReplyToAddresses:e.replyTo},(e,t)=>{e?s(e):r(t)})})};var s=a(r(47)),n=a(r(0));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.userWelcomeEmail=function(){return s.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"welcomeEmail.html\"),\"utf8\")},t.courierWelcomeEmail=function(e){return`${o}\\n  <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnTextBlockOuter\">\\n        <tr>\\n            <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n                <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                    <tbody>\\n                        <tr>\\n                            <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                                <h1 id=\"_name\" style=\"text-align: left;\">\\n  <span style=\"font-size:24px\">Thank you for choosing GooSendr</span>\\n  </h1></td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnDividerBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnDividerBlockOuter\">\\n        <tr>\\n            <td class=\"mcnDividerBlockInner\" style=\"min-width: 100%; padding: 18px 18px 0px;\">\\n                <table class=\"mcnDividerContent\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"min-width:100%;\">\\n                    <tbody>\\n                        <tr>\\n                            <td> <span></span></td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnTextBlockOuter\">\\n        <tr>\\n            <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n                <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                    <tbody>\\n                        <tr>\\n                            <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                                <p align=\"left\"> <span style=\"color:#000000\">\\n  Congratulations! You have successfully registered with GooSendr as a courier.<br/><br/>\\n  You've entered <strong><a href=\"mailto:${e.email}\" target=\"_blank\" >${e.email}</a> </strong> as the contact email address for your GooSendr account. To complete the process, we just need to verify that this email address belongs to you. Simply click the link below and sign in.</span></p>\\n\\n                                <p style=\"padding: 5px; margin: 0 0 6px;\"><strong> <a style=\"background: #3853a4; color: #fff; display: block; font-size: 12px; font-weight: bold; height: 24px; line-height: 20px; padding-top: 2px; text-align: center; text-decoration: none; width: 99px;\" href=\"${a.default.url}/email-verification?token=${e.token}&email=${e.email}\" target=\"_blank\" >Verify Now</a> </strong></p>\\n                                <p align=\"left\"> <span style=\"color:#000000\"> <strong>This link is only valid for 24 hours.</strong> </span></p>\\n                            </td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n  ${d}`},t.forgotPassword=function(e){return`${o}\\n  <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnTextBlockOuter\">\\n        <tr>\\n            <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n                <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                    <tbody>\\n                        <tr>\\n                            <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                                <h1 id=\"_name\" style=\"text-align: left;\">\\n  <span style=\"font-size:24px\">Hello ${e.username}</span>\\n  </h1></td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnDividerBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnDividerBlockOuter\">\\n        <tr>\\n            <td class=\"mcnDividerBlockInner\" style=\"min-width: 100%; padding: 18px 18px 0px;\">\\n                <table class=\"mcnDividerContent\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"min-width:100%;\">\\n                    <tbody>\\n                        <tr>\\n                            <td> <span></span></td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n    <tbody class=\"mcnTextBlockOuter\">\\n        <tr>\\n            <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n                <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                    <tbody>\\n                        <tr>\\n                            <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                                <p align=\"left\"> <span style=\"color:#000000\"> We're sorry you're having trouble logging into your <span class=\"il\">gooSendr</span> account. We're happy to be of service, just click on the forget my password link.\\n                                    <a href=\"${a.default.url}/reset-password?token=${e.token}\" target=\"_blank\">reset password</a>\\n                                    </span>\\n                                </p>\\n                                <p align=\"left\"> <span style=\"color:#000000\"> <strong>This link is only valid for 24 hours.</strong> </span></p>\\n                                <p align=\"left\"> <span style=\"color:#000000\"> If you didn't ask us for help with your password,send an email to <a>support@<span class=\"il\">gooltd</span>.com</a> or call us at <strong>(+233)-20-051 6773</strong>. </span>\\n                                </p>\\n                                <p align=\"left\"><span style=\"color:#000000\">Reporting, it is important because it helps us prevent fraudsters from stealing your information</span></p>\\n                            </td>\\n                        </tr>\\n                    </tbody>\\n                </table>\\n            </td>\\n        </tr>\\n    </tbody>\\n</table>\\n   ${d}`},t.resetPassword=function(e){return`\\n  ${o}\\n  <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n  <tbody class=\"mcnTextBlockOuter\">\\n      <tr>\\n          <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n              <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                  <tbody>\\n                      <tr>\\n                          <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                              <h1 id=\"_name\" style=\"text-align: left;\">\\n<span style=\"font-size:24px\">Hello ${e.username}</span>\\n</h1></td>\\n                      </tr>\\n                  </tbody>\\n              </table>\\n          </td>\\n      </tr>\\n  </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnDividerBlock\" style=\"min-width:100%;\">\\n  <tbody class=\"mcnDividerBlockOuter\">\\n      <tr>\\n          <td class=\"mcnDividerBlockInner\" style=\"min-width: 100%; padding: 18px 18px 0px;\">\\n              <table class=\"mcnDividerContent\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"min-width:100%;\">\\n                  <tbody>\\n                      <tr>\\n                          <td> <span></span></td>\\n                      </tr>\\n                  </tbody>\\n              </table>\\n          </td>\\n      </tr>\\n  </tbody>\\n</table>\\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\">\\n  <tbody class=\"mcnTextBlockOuter\">\\n      <tr>\\n          <td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\">\\n              <table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\">\\n                  <tbody>\\n                      <tr>\\n                          <td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n                              <p align=\"left\"> <span style=\"color:#000000\">\\n   You just changed your password.<br /> If you didn't change your password, give us a call right away at <strong>(+233)-20-051 6773</strong>\\n   </span></p>\\n                              <p>Just a reminder:</p>\\n                              <ul>\\n                                  <li style=\"text-indent: 0px;margin-left: 28px;\">Never share your password with anyone.</li>\\n                                  <li style=\"text-indent: 0px;margin-left: 28px;\">\\n                                      Create passwords that are hard to guess and don't use personal information. Be sure to include uppercase and lowercase letters, numbers, and symbols.</li>\\n                              </ul>\\n                          </td>\\n                      </tr>\\n                  </tbody>\\n              </table>\\n          </td>\\n      </tr>\\n  </tbody>\\n</table>\\n  ${d}\\n  `};var s=i(r(48)),n=i(r(49)),a=i(r(0));function i(e){return e&&e.__esModule?e:{default:e}}const o=s.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"header.html\"),\"utf8\"),d=s.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"footer.html\"),\"utf8\")},function(e,t,r){\"use strict\";var s=c(r(1)),n=c(r(8)),a=c(r(10)),i=c(r(5)),o=c(r(9)),d=c(r(19)),u=c(r(20)),l=c(r(0));function c(e){return e&&e.__esModule?e:{default:e}}const p=r(21)(l.default.twilio.authyKey),f=(0,u.default)(l.default.twilio.accountSid,l.default.twilio.authToken),y=s.default.Schema({fullName:{type:String,required:[!0,\"fullName is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0},password:{type:String,required:[!0,\"Password is required!\"],trim:!0,minlength:[4,\"Password need to be longer!\"]},phone:{type:String,unique:!0,required:[!0,\"Phone Number is required!\"],trim:!0},countryCode:{type:String,required:[!0,\"countryCode is required!\"],trim:!0},authyId:String,verified:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1},ip:String,resetPassword:{token:String,expire:Date},confirmEmail:{token:String,expire:Date},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},address1:{type:String,required:!0,trim:!0},address2:{type:String,required:!1,trim:!0},deviceToken:{type:String,required:!1,trim:!0},avatar:{}});y.pre(\"save\",async function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),this.ip||(this.ip=await this.getIP()),e()}),y.plugin(a.default,{message:\"{VALUE} already taken!\"}),y.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return o.default.sign({_id:this._id},l.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,address1:this.address1,address2:this.address2,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,address1:this.address1,address2:this.address2,avatar:this.avatar}},_login:{async save(){return this.ip=await this.getIP(),this.lastlogin=new Date,await this.save()}},getIP:()=>d.default.v4(),verifyAuthyToken(e){return new Promise((t,r)=>{p.verify(this.authyId,e,(e,s)=>{e&&r(e),s&&t(s)})})},sendAuthyToken(){return new Promise((e,t)=>{function r(r){p.request_sms(r,!0,(r,s)=>{r&&t(r),s&&e(s)})}this.authyId?r(this.authyId):p.register_user(this.email,this.phone,this.countryCode,async(e,s)=>{e&&t(e),this.authyId=s.user.id,await this.save(),r(this.authyId)})})},async sendMessage(e){return await f.sendMessage({to:`+${this.countryCode}${this.phone}`,from:l.default.twillio.number,body:e})}},y.plugin(n.default),e.exports=s.default.model(\"Courier\",y)},function(e,t,r){\"use strict\";var s=o(r(2)),n=o(r(0));r(26);var a=o(r(27)),i=o(r(35));function o(e){return e&&e.__esModule?e:{default:e}}const d=(0,s.default)();(0,a.default)(d),d.get(\"/\",(e,t)=>{t.send(\"Hello world!\")}),d.get(\"/reset-password\",(e,t)=>{t.send(`token: ${e.query.token}`)}),d.get(\"/email-verification\",(e,t)=>{t.send(`token: ${e.query.token}, email: ${e.query.email}`)}),d.post(\"/email-notifications\",(e,t)=>{console.log(e.headers),t.status(200).json()}),(0,i.default)(d),d.listen(n.default.PORT,e=>{if(e)throw e;console.log(`Server running on port: ${n.default.PORT} - Running on production`)})},function(e,t,r){\"use strict\";var s=a(r(1)),n=a(r(0));function a(e){return e&&e.__esModule?e:{default:e}}s.default.Promise=global.Promise;try{s.default.connect(n.default.MONGO_URL)}catch(e){s.default.createConnection(n.default.MONGO_URL)}s.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});l(r(28));var s=r(29),n=l(r(30)),a=l(r(31)),i=l(r(3)),o=l(r(32)),d=l(r(33)),u=l(r(34));function l(e){return e&&e.__esModule?e:{default:e}}const c={customCss:\".swagger-ui .topbar { display: none }\"};t.default=(e=>{e.use((0,n.default)()),e.use((0,a.default)()),e.use((0,s.json)()),e.use((0,s.urlencoded)({extended:!0})),e.use((0,o.default)({credentials:!0,origin:!0})),e.use(i.default.initialize()),e.use(\"/api-docs\",d.default.serve,d.default.setup(u.default,c))})},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"helmet\")},function(e,t){e.exports=require(\"cors\")},function(e,t){e.exports=require(\"swagger-ui-express\")},function(e){e.exports={swagger:\"2.0\",info:{description:\"Api documentation for GooSendr. A logistics application.<br><br><br> <b>NEW</b><br> 1. Removal of username field <br> 2. Addition of the courier api<br><br>\",version:\"1.0.0\",title:\"GooSendr Api Documentation\",termsOfService:\"\",contact:{email:\"aditech5170@gmail.com\"}},host:\"localhost:3000\",basePath:\"/api/v1\",tags:[{name:\"user\",description:\"\",externalDocs:{description:\"\",url:\"http://localhost:3000\"}},{name:\"courier\",externalDocs:{description:\"\",url:\"http://localhost:3000\"}}],schemes:[\"http\"],paths:{\"/user/register\":{post:{tags:[\"user\"],summary:\"Create user\",description:\"Refistering a new user.\",operationId:\"createUser\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Created user object\",required:!0,schema:{$ref:\"#/definitions/registration.model\"}}],responses:{201:{description:\"OK\",schema:{$ref:\"#/definitions/auth.model\"}},400:{description:\"\"}}}},\"/user/resend/{id}\":{get:{tags:[\"user\"],summary:\"Resend sms auth-token\",description:\"\",operationId:\"resend\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/verify/{id}\":{put:{tags:[\"user\"],summary:\"Send verification code\",description:\"\",operationId:\"verify\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"},{in:\"body\",name:\"body\",description:\"code received on phone\",required:!0,schema:{$ref:\"#/definitions/verificationCode.model\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/auth.model\"}},400:{description:\"invalid code\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/login\":{post:{tags:[\"user\"],summary:\"Logs user into the system\",description:\"\",operationId:\"loginUser\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"user login information\",required:!0,schema:{$ref:\"#/definitions/login.model\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/auth.model\"}},401:{description:\"UNAUTHORIZED\"}}}},\"/user/forgot-password\":{post:{tags:[\"user\"],summary:\"Forgot password\",description:\"\",operationId:\"forgotPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"The user email registered in the system. \",required:!0,schema:{$ref:\"#/definitions/forgotPassword.model\"}}],responses:{200:{description:\"OK\"},400:{description:\"UNAUTHORIZED\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/reset-password\":{post:{tags:[\"user\"],summary:\"Reset password with token from user's email\",description:\"\",operationId:\"resetPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Token and Password\",required:!0,schema:{$ref:\"#/definitions/resetPassword.model\"}}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/change-password\":{patch:{tags:[\"user\"],summary:\"Changing of password\",description:\"This can only be done by the logged in user.\",operationId:\"changePassword\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/changePassword.model\"}}],security:[{Bearer:[]}],responses:{200:{description:\"OK\"},400:{description:\"invalid old password\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/update-user\":{patch:{tags:[\"user\"],summary:\"Update user Information\",description:\"This can only be done by the logged in user.\",operationId:\"updateUser\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/updateInfo.model\"}}],responses:{200:{description:\"OK\",schema:{$ref:\"#/definitions/info.model\"}},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}},security:[{Bearer:[]}]}},\"/courier/register\":{post:{tags:[\"courier\"],summary:\"Create user\",description:\"Refistering a new user.\",operationId:\"createCourierUser\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Created user object\",required:!0,schema:{$ref:\"#/definitions/courierRegistration.model\"}}],responses:{201:{description:\"OK\",schema:{$ref:\"#/definitions/courierAuth.model\"}},400:{description:\"\"}}}},\"/courier/resend/{id}\":{get:{tags:[\"courier\"],summary:\"Resend sms auth-token\",description:\"\",operationId:\"courierResend\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/verify/{id}\":{put:{tags:[\"courier\"],summary:\"Send verification code\",description:\"\",operationId:\"courierVerify\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"},{in:\"body\",name:\"body\",description:\"code received on phone\",required:!0,schema:{$ref:\"#/definitions/verificationCode.model\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/courierAuth.model\"}},400:{description:\"invalid code\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/resend-email/{id}\":{get:{tags:[\"courier\"],summary:\"Resend email for confirmation\",description:\"\",operationId:\"courierResendEmail\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/confirm-email/{id}\":{put:{tags:[\"courier\"],summary:\"Send verification code\",description:\"\",operationId:\"courierConfirmEmail\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of registered user\",required:!0,type:\"string\"},{in:\"body\",name:\"body\",description:\"code received on phone\",required:!0,schema:{$ref:\"#/definitions/emailconfimation.model\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/courierInfo.model\"}},400:{description:\"invalid code\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/login\":{post:{tags:[\"courier\"],summary:\"Logs courier into the system\",description:\"\",operationId:\"loginCourier\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"user login information\",required:!0,schema:{$ref:\"#/definitions/login.model\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/courierAuth.model\"}},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/forgot-password\":{post:{tags:[\"courier\"],summary:\"Forgot password\",description:\"\",operationId:\"courierForgotPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"The user email registered in the system. \",required:!0,schema:{$ref:\"#/definitions/forgotPassword.model\"}}],responses:{200:{description:\"OK\"},400:{description:\"UNAUTHORIZED\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/reset-password\":{post:{tags:[\"courier\"],summary:\"Reset password with token from user's email\",description:\"\",operationId:\"courierResetPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Token and Password\",required:!0,schema:{$ref:\"#/definitions/resetPassword.model\"}}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/change-password\":{patch:{tags:[\"courier\"],summary:\"Changing of password\",description:\"This can only be done by the logged in user.\",operationId:\"courierChangePassword\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/changePassword.model\"}}],security:[{Bearer:[]}],responses:{200:{description:\"OK\"},400:{description:\"invalid old password\"},401:{description:\"UNAUTHORIZED\"}}}},\"/courier/update-user\":{patch:{tags:[\"courier\"],summary:\"Update courier Information\",description:\"This can only be done by the logged in user.\",operationId:\"courierUpdateUser\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/courierUpdateInfo.model\"}}],responses:{200:{description:\"OK\",schema:{$ref:\"#/definitions/courierInfo.model\"}},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}},security:[{Bearer:[]}]}}},securityDefinitions:{Bearer:{type:\"apiKey\",name:\"Authorization\",in:\"header\"}},definitions:{\"registration.model\":{type:\"object\",properties:{fullName:{type:\"string\"},email:{type:\"string\"},password:{type:\"string\"},phone:{type:\"string\"},countryCode:{type:\"string\",description:\"eg +233\"},avatar:{type:\"object\"}}},\"courierRegistration.model\":{type:\"object\",properties:{fullName:{type:\"string\"},email:{type:\"string\"},password:{type:\"string\"},phone:{type:\"string\"},countryCode:{type:\"string\",description:\"eg +233\"},address1:{type:\"string\"},address2:{type:\"string\",description:\"optional\"},avatar:{type:\"object\"}}},\"updateInfo.model\":{type:\"object\",properties:{fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},facebook:{type:\"object\"},google:{type:\"object\"},countryCode:{type:\"string\",description:\"eg +233\"},avatar:{type:\"object\"}}},\"courierUpdateInfo.model\":{type:\"object\",properties:{fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},address1:{type:\"string\"},address2:{type:\"string\",description:\"optional\"},countryCode:{type:\"string\",description:\"eg +233\"},avatar:{type:\"object\"}}},\"info.model\":{type:\"object\",properties:{_id:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},facebook:{type:\"object\"},google:{type:\"object\"},avatar:{type:\"object\"}}},\"courierInfo.model\":{type:\"object\",properties:{_id:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},address1:{type:\"string\"},address2:{type:\"string\"},avatar:{type:\"object\"}}},\"auth.model\":{type:\"object\",properties:{_id:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},facebook:{type:\"object\"},google:{type:\"object\"},avatar:{type:\"object\"},token:{type:\"string\"}}},\"courierAuth.model\":{type:\"object\",properties:{_id:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},address1:{type:\"string\"},address2:{type:\"string\"},avatar:{type:\"object\"},token:{type:\"string\"}}},\"verificationCode.model\":{type:\"object\",properties:{code:{type:\"string\"}}},\"emailconfimation.model\":{type:\"object\",properties:{token:{type:\"string\"},email:{type:\"string\"}}},\"resetPassword.model\":{type:\"object\",properties:{token:{type:\"string\"},newPassword:{type:\"string\"},verifyPassword:{type:\"string\"}}},\"changePassword.model\":{type:\"object\",properties:{newPassword:{type:\"string\"},oldPassword:{type:\"string\"}}},\"login.model\":{type:\"object\",properties:{email:{type:\"string\"},password:{type:\"string\"}}},\"forgotPassword.model\":{type:\"object\",properties:{email:{type:\"string\"}}}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=o(r(36)),n=o(r(42)),a=o(r(45)),i=o(r(52));function o(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use(\"/api/v1/admin\",s.default),e.use(\"/api/v1/posts\",n.default),e.use(\"/api/v1/user\",a.default),e.use(\"/api/v1/courier\",i.default)})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),n=d(r(4)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(37)),i=d(r(41)),o=r(16);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/register\",(0,n.default)(i.default.register),a.AddAdmin),u.post(\"/login\",o.authLocal,a.login),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.AddAdmin=async function(e,t){(async()=>{const r=e.body;r._id=new s.default.Types.ObjectId,r.ip=i.default.getIP(e),r.loginType=\"admin\";try{const e=await i.default.save(r);return t.status(a.default.CREATED).json(e.toAuthJSON())}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}})().then()},t.fetch=async function(e,t){const r=e.params.page?parseInt(e.params.page,10):1,s=e.params.limit?parseInt(e.params.limit,10):10;try{const e=await i.default.fetch({},r,s);return t.status(a.default.OK).json(e)}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}},t.fetchOne=async function(e,t){try{const r=await i.default.fetchOne({_id:e.params.id});return t.status(a.default.OK).json(r)}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){const s=e.user;s.lastlogin=new Date,s.ip=i.default.getIP(e),s.loginType=\"admin\",s.loggedIn=!0,(async s=>{try{const n=await i.default.update({_id:s._id},s,{multi:!1});return n?(t.status(a.default.OK).json(e.user.toAuthJSON()),r()):(t.status(a.default.BAD_REQUEST).json({message:\"Unknown  error occurred!\"}),r())}catch(e){return t.status(a.default.BAD_REQUEST).json(e),r()}})(s).then()},t.update=async function(e,t){const r={name:e.body.name,email:e.body.email,type:e.body.type,avatar:e.body.avatar};try{const s=await i.default.update({_id:e.params.id},r);return t.status(a.default.OK).json(s)}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}},t.editPassword=async function(e,t){if(\"\"===e.body.pass1||\"\"===e.body.pass2||\"\"===e.body.password)return t.status(a.default.BAD_REQUEST).json({message:\"Please fill out all fields\"});if(e.body.pass1!==e.body.pass2)return t.status(a.default.BAD_REQUEST).json({message:\"Passwords do not match\"});let r=async r=>{try{const s=await i.default.update({_id:e.params.id},{password:r},{multi:!1});return t.status(a.default.OK).json(s)}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}};try{const s=await i.default.fetchOne({_id:e.params.id});if(!s)return t.status(a.default.BAD_REQUEST).json({message:\"You're not eligible to change the password\"});if(!n.default.compareSync(e.body.password,s.password))return t.status(a.default.BAD_REQUEST).json({message:\"Invalid old password\"});(async()=>{n.default.hash(e.body.pass1,null,null,(e,t)=>{r(t).then()})})().then()}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}},t.deleteAdmin=async function(e,t){try{const r=await i.default.delete({_id:e.params.id});return t.status(a.default.OK).json(r)}catch(e){return t.status(a.default.BAD_REQUEST).json(e)}};var s=o(r(1)),n=o(r(5)),a=o(r(6)),i=o(r(13));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"slug\")},function(e,t){e.exports=require(\"ipware\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,n=r(7),a=(s=n)&&s.__esModule?s:{default:s};t.default={register:{body:{email:a.default.string().email().required(),password:a.default.string().regex(/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/).required(),type:a.default.string().required(),name:a.default.string().required()}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),n=d(r(4)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(43)),i=d(r(44)),o=r(16);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/\",o.authJwt,(0,n.default)(i.default.createPost),a.createPost_),u.get(\"/:id\",o.authJwt,a.getPostById),u.get(\"/\",o.authJwt,a.getPostsList),u.patch(\"/:id\",o.authJwt,(0,n.default)(i.default.updatePost),a.updatePost),u.delete(\"/:id\",o.authJwt,a.deletePost),u.post(\"/:id/favorite\",o.authJwt,a.favoritePost),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.createPost_=async function(e,t){try{const r=await(0,n.createPost)(e.body,e.user._id);return t.status(s.default.CREATED).json(r)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.getPostById=async function(e,t){try{const r=await Promise.all([a.default.findById(e.user._id),(0,n.findById)(e.params.id).populate(\"user\")]),i=r[0]._favorites.isPostIsFavorite(e.params.id),o=r[1];return t.status(s.default.OK).json({...o.toJSON(),favorite:i})}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.getPostsList=async function(e,t){const r=parseInt(e.query.limit,0),i=parseInt(e.query.skip,0);try{const o=await Promise.all([a.default.findById(e.user._id),(0,n.list)({limit:r,skip:i})]),d=o[1].reduce((e,t)=>{const r=o[0]._favorites.isPostIsFavorite(t._id);return e.push({...t.toJSON(),favorite:r}),e},[]);return t.status(s.default.OK).json(d)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.updatePost=async function(e,t){try{const r=await(0,n.findById)(e.params.id);return r.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.default.OK).json(await r.save())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.deletePost=async function(e,t){try{const r=await(0,n.findById)(e.params.id);return r.user.equals(e.user._id)?(await r.remove(),t.sendStatus(s.default.OK)):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.favoritePost=async function(e,t){try{const r=await a.default.findById(e.user._id);return await r._favorites.posts(e.params.id),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var s=i(r(6)),n=r(15),a=i(r(14));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,n=r(7),a=(s=n)&&s.__esModule?s:{default:s};t.default={createPost:{body:{title:a.default.string().min(3).required(),text:a.default.string().min(10).required()}},updatePost:{body:{title:a.default.string().min(3),text:a.default.string().min(10)}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),n=d(r(4)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(46)),i=d(r(50)),o=r(51);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/register\",(0,n.default)(i.default.register),a.createUser),u.get(\"/resend/:id\",a.resendSmsToken),u.put(\"/verify/:id\",(0,n.default)(i.default.verify),a.verifySmsToken),u.post(\"/login\",o.userAuthLocal,a.login),u.post(\"/forgot-password\",(0,n.default)(i.default.forgotPassword),a.forgotPassword),u.post(\"/reset-password\",(0,n.default)(i.default.resetPassword),a.resetPassword),u.patch(\"/change-password\",(0,n.default)(i.default.changePassword),o.userAuthJwt,a.changePassword),u.patch(\"/update-user\",(0,n.default)(i.default.update),o.userAuthJwt,a.updateUser),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.createUser=async function(e,t){try{const r=await a.default.create(e.body),n=o.userWelcomeEmail();return await Promise.all([r.sendAuthyToken(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[e.body.email],subject:\"Welcome to GooSendr\",body:n})]),t.status(s.default.CREATED).json(r.toAuthJSON())}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resendSmsToken=async function(e,t){try{const r=await a.default.findById(e.params.id);return r?(await r.sendAuthyToken(),t.sendStatus(s.default.OK)):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.verifySmsToken=async function(e,t){try{const r=await a.default.findById(e.params.id);return r?(await r.verifyAuthyToken(e.body.code),r.verified=!0,await r.save(),t.status(s.default.OK).json(r.toAuthJSON())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){return await e.user._login.save(),t.status(s.default.OK).json(e.user.toAuthJSON()),r()},t.forgotPassword=async function(e,t){try{const r=await a.default.findOne({email:e.body.email});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);const u=n.default.randomBytes(20).toString(\"hex\"),l=o.forgotPassword({username:r.fullName,token:u});return r.resetPassword={token:u,expire:new Date(+new Date+864e5)},await Promise.all([r.save(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[e.body.email],subject:\"GooSendr Password Reset\",body:l})]),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resetPassword=async function(e,t){try{const r=await a.default.findOne({\"resetPassword.token\":e.body.token,\"resetPassword.expire\":{$gt:Date.now()}});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);if(e.body.newPassword!==e.body.verifyPassword)return t.status(s.default.BAD_REQUEST).json({messge:\"Passwords do not match\"});const n=o.resetPassword({username:r.fullName});return r.password=e.body.newPassword,r.resetPassword={token:void 0,expire:void 0},await Promise.all([r.save(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[r.email],subject:\"Your password has been changed\",body:n})]),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.changePassword=async function(e,t){try{const r=e.user;return r.authenticateUser(e.body.oldPassword)?(r.password=e.body.newPassword,await r.save(),t.sendStatus(s.default.OK)):t.status(s.default.BAD_REQUEST).json({messge:\"invalid old password\"})}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.updateUser=async function(e,t){try{const r=e.user;return Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.default.OK).json(await r.save())}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var s=u(r(6)),n=u(r(17)),a=u(r(18)),i=u(r(22)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(23)),d=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require(\"aws-sdk\")},function(e,t){e.exports=require(\"fs\")},function(e,t){e.exports=require(\"path\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,n=r(7),a=(s=n)&&s.__esModule?s:{default:s};const i=/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;t.default={register:{body:{fullName:a.default.string().required(),email:a.default.string().email().required(),password:a.default.string().regex(i).required(),phone:a.default.number().required(),countryCode:a.default.string().required()}},update:{body:{firstName:a.default.string(),lastName:a.default.string(),email:a.default.string().email(),password:a.default.forbidden(),phone:a.default.string()}},verify:{body:{code:a.default.string().required()}},forgotPassword:{body:{email:a.default.string().required()}},resetPassword:{body:{token:a.default.string().required(),newPassword:a.default.string().regex(i).required(),verifyPassword:a.default.string().required()}},changePassword:{body:{oldPassword:a.default.string().required(),newPassword:a.default.string().regex(i).required()}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.userAuthJwt=t.userAuthLocal=void 0;var s=d(r(3)),n=d(r(11)),a=r(12),i=d(r(18)),o=d(r(0));function d(e){return e&&e.__esModule?e:{default:e}}const u=new n.default({usernameField:\"email\"},async(e,t,r)=>{try{const s=await i.default.findOne({email:e});return s&&s.authenticateUser(t)?r(null,s):r(null,!1)}catch(e){return r(e,!1)}}),l={jwtFromRequest:a.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:o.default.JWT_SECRET},c=new a.Strategy(l,async(e,t)=>{try{const r=await i.default.findOne({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});s.default.use(u),s.default.use(c);t.userAuthLocal=s.default.authenticate(\"local\",{session:!1}),t.userAuthJwt=s.default.authenticate(\"jwt\",{session:!1})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),n=d(r(4)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(53)),i=d(r(54)),o=r(55);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/register\",(0,n.default)(i.default.register),a.createUser),u.get(\"/resend/:id\",a.resendSmsToken),u.put(\"/verify/:id\",(0,n.default)(i.default.verify),a.verifySmsToken),u.get(\"/resend-email/:id\",a.resendEmail),u.put(\"/confirm-email/:id\",(0,n.default)(i.default.confirmEmail),a.confirmEmail),u.post(\"/login\",o.courierAuthLocal,a.login),u.post(\"/forgot-password\",(0,n.default)(i.default.forgotPassword),a.forgotPassword),u.post(\"/reset-password\",(0,n.default)(i.default.resetPassword),a.resetPassword),u.patch(\"/change-password\",(0,n.default)(i.default.changePassword),o.courierAuthJwt,a.changePassword),u.patch(\"/update-user\",(0,n.default)(i.default.update),o.courierAuthJwt,a.updateInfo),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.createUser=async function(e,t){try{const r={token:n.default.randomBytes(20).toString(\"hex\"),expire:new Date(+new Date+864e5)},u=await a.default.create({...e.body,confirmEmail:r}),l=o.courierWelcomeEmail({email:u.email,token:u.confirmEmail.token});return await Promise.all([u.sendAuthyToken(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[e.body.email],subject:\"Welcome to GooSendr\",body:l})]),t.status(s.default.CREATED).json(u.toAuthJSON())}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resendSmsToken=async function(e,t){try{const r=await a.default.findById(e.params.id);return r?(await r.sendAuthyToken(),t.sendStatus(s.default.OK)):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.verifySmsToken=async function(e,t){try{const r=await a.default.findById(e.params.id);return r?(await r.verifyAuthyToken(e.body.code),r.verified=!0,await r.save(),t.status(s.default.OK).json(r.toAuthJSON())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resendEmail=async function(e,t){try{const r=await a.default.findById(e.params.id);if(!r)return t.sendStatus(s.default.UNAUTHORIZED);const u=n.default.randomBytes(20).toString(\"hex\");r.confirmEmail={token:u,expire:new Date(+new Date+864e5)};const l=o.courierWelcomeEmail({email:r.email,token:u});return await Promise.all([r.save(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[r.email],subject:\"Welcome to GooSendr\",body:l})]),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.confirmEmail=async function(e,t){try{const r=await a.default.findOne({\"confirmEmail.token\":e.body.token,\"confirmEmail.expire\":{$gt:Date.now()},email:e.body.email});return r?r.confirmed?t.status(s.default.BAD_REQUEST).json({messge:\"this email has already been confirmed\"}):(r.confirmed=!0,r.confirmEmail.token=void 0,r.confirmEmail.expire=void 0,t.status(s.default.OK).json(await r.save())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){return await e.user._login.save(),t.status(s.default.OK).json(e.user.toAuthJSON()),r()},t.forgotPassword=async function(e,t){try{const r=await a.default.findOne({email:e.body.email});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);const u=n.default.randomBytes(20).toString(\"hex\"),l=o.forgotPassword({username:r.fullName,token:u});return r.resetPassword={token:u,expire:new Date(+new Date+864e5)},await Promise.all([r.save(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[e.body.email],subject:\"GooSendr Password Reset\",body:l})]),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resetPassword=async function(e,t){try{const r=await a.default.findOne({\"resetPassword.token\":e.body.token,\"resetPassword.expire\":{$gt:Date.now()}});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);if(e.body.newPassword!==e.body.verifyPassword)return t.status(s.default.BAD_REQUEST).json({messge:\"Passwords do not match\"});const n=o.resetPassword({username:r.fullName});return r.password=e.body.newPassword,r.resetPassword.token=void 0,r.resetPassword.expire=void 0,await Promise.all([r.save(),(0,i.default)({from:`GooSendr <${d.default.no_reply}>`,to:[r.email],subject:\"Your password has been changed\",body:n})]),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.changePassword=async function(e,t){try{const r=e.user;return r.authenticateUser(e.body.oldPassword)?(r.password=e.body.newPassword,await r.save(),t.sendStatus(s.default.OK)):t.status(s.default.BAD_REQUEST).json({messge:\"invalid old password\"})}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.updateInfo=async function(e,t){try{const r=e.user;return Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.default.OK).json(await r.save())}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var s=u(r(6)),n=u(r(17)),a=u(r(24)),i=u(r(22)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(23)),d=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,n=r(7),a=(s=n)&&s.__esModule?s:{default:s};const i=/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;t.default={register:{body:{fullName:a.default.string().required(),email:a.default.string().email().required(),password:a.default.string().regex(i).required(),phone:a.default.number().required(),countryCode:a.default.string().required(),address1:a.default.string().required()}},update:{body:{firstName:a.default.string(),lastName:a.default.string(),email:a.default.string().email(),phone:a.default.string(),password:a.default.forbidden(),address1:a.default.string()}},verify:{body:{code:a.default.string().required()}},confirmEmail:{body:{token:a.default.string().required(),email:a.default.string().email().required()}},forgotPassword:{body:{email:a.default.string().required()}},resetPassword:{body:{token:a.default.string().required(),newPassword:a.default.string().regex(i).required(),verifyPassword:a.default.string().required()}},changePassword:{body:{oldPassword:a.default.string().required(),newPassword:a.default.string().regex(i).required()}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.courierAuthJwt=t.courierAuthLocal=void 0;var s=d(r(3)),n=d(r(11)),a=r(12),i=d(r(24)),o=d(r(0));function d(e){return e&&e.__esModule?e:{default:e}}const u=new n.default({usernameField:\"email\"},async(e,t,r)=>{try{const s=await i.default.findOne({email:e});return s&&s.authenticateUser(t)?r(null,s):r(null,!1)}catch(e){return r(e,!1)}}),l={jwtFromRequest:a.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:o.default.JWT_SECRET},c=new a.Strategy(l,async(e,t)=>{try{const r=await i.default.findOne({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});s.default.use(u),s.default.use(c);t.courierAuthLocal=s.default.authenticate(\"local\",{session:!1}),t.courierAuthJwt=s.default.authenticate(\"jwt\",{session:!1})}]);","extractedComments":[]}