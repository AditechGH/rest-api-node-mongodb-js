{"code":"module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=12)}([function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const n={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\"},a={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},s={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\"},i={PORT:process.env.PORT||3e3};t.default={...i,...function(e){switch(e){case\"development\":return n;case\"test\":return a;default:return s}}(\"production\")}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.authJwt=t.authLocal=void 0;var n=u(r(4)),a=u(r(29)),s=r(30),i=r(8);function u(e){return e&&e.__esModule?e:{default:e}}const o=new a.default({usernameField:\"email\"},async(e,t,r)=>{try{const n=await(0,i.fetchOne)({email:e});return n&&n.authenticateUser(t)?r(null,n):r(null,!1)}catch(e){return r(e,!1)}}),d={jwtFromRequest:s.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:\"JWT_SECRET\"},l=new s.Strategy(d,async(e,t)=>{try{const r=await(0,i.fetchOne)({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});n.default.use(o),n.default.use(l);t.authLocal=n.default.authenticate(\"local\",{session:!1}),t.authJwt=n.default.authenticate(\"jwt\",{session:!1})},function(e,t){e.exports=require(\"passport\")},function(e,t){e.exports=require(\"express-validation\")},function(e,t){e.exports=require(\"bcrypt-nodejs\")},function(e,t){e.exports=require(\"http-status\")},function(e,t,r){\"use strict\";const n=r(9).default,a=r(27)().get_ip;t.save=(async e=>{try{const t=new n(e);return await t.save()}catch(e){throw Error(e)}}),t.fetch=(async(e,t,r)=>{try{return await n.paginate(e,{page:t,limit:r,sort:{_id:\"asc\"}})}catch(e){throw Error(\"Error while paginating admins\")}}),t.fetchOne=(async e=>{try{return await n.findOne(e)}catch(e){throw Error(\"Error fetching admin\")}}),t.update=(async(e,t)=>{try{return await n.updateOne(e,{$set:t})}catch(e){throw Error(\"Error editing admin\")}}),t.delete=(async e=>{try{return await n.deleteOne(e)}catch(e){throw Error(\"Error deleting admin\")}}),t.getIP=(e=>{return a(e).clientIp})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=l(r(0)),a=l(r(22)),s=l(r(23)),i=l(r(6)),u=l(r(24)),o=l(r(2)),d=l(r(10));function l(e){return e&&e.__esModule?e:{default:e}}const c=n.default.Schema({name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>a.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:n.default.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});c.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),c.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return u.default.sign({_id:this._id},o.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,password:this.password,type:this.type,ip:this.ip,signup:this.signup,lastlogin:this.lastlogin,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(e){return this.favorites.posts.indexOf(e)>=0?(this.favorites.posts.remove(e),await d.default.decFavoriteCount(e)):(this.favorites.posts.push(e),await d.default.incFavoriteCount(e)),this.save()},isPostIsFavorite(e){return this.favorites.posts.indexOf(e)>=0}}},c.plugin(s.default),t.default=n.default.model(\"Admin\",c)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=i(r(0)),a=i(r(25)),s=i(r(26));function i(e){return e&&e.__esModule?e:{default:e}}const u=n.default.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:n.default.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});u.plugin(s.default,{message:\"{VALUE} already taken!\"}),u.pre(\"validate\",function(e){this._slugify(),e()}),u.methods={_slugify(){this.slug=(0,a.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},u.statics={createPost(e,t){return this.create({...e,user:t})},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate(\"user\")},incFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:1}})},decFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:-1}})}},t.default=n.default.model(\"Post\",u)},function(e,t){e.exports=require(\"joi\")},function(e,t,r){\"use strict\";var n=u(r(1)),a=u(r(2));r(13);var s=u(r(14)),i=u(r(19));function u(e){return e&&e.__esModule?e:{default:e}}const o=(0,n.default)();(0,s.default)(o),o.get(\"/\",(e,t)=>{t.send(\"Hello world!\")}),(0,i.default)(o),o.listen(a.default.PORT,e=>{if(e)throw e;console.log(`Server running on port: ${a.default.PORT}\\n\\n    -- - Running on production`)})},function(e,t,r){\"use strict\";var n=s(r(0)),a=s(r(2));function s(e){return e&&e.__esModule?e:{default:e}}n.default.Promise=global.Promise;try{n.default.connect(a.default.MONGO_URL)}catch(e){n.default.createConnection(a.default.MONGO_URL)}n.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});u(r(15));var n=r(16),a=u(r(17)),s=u(r(18)),i=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use((0,a.default)()),e.use((0,s.default)()),e.use((0,n.json)()),e.use((0,n.urlencoded)({extended:!0})),e.use(i.default.initialize())})},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"helmet\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(20)),a=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use(\"/api/v1/admin\",n.default),e.get(\"/hello\",a.default,(e,t)=>{t.send(\"This is a private route!!!!\")})})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=r(1),a=o(r(5)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(21)),i=o(r(28)),u=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}const d=(0,n.Router)();d.post(\"/register\",(0,a.default)(i.default.register),s.AddAdmin),d.post(\"/login\",u.default,s.login),t.default=d},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.AddAdmin=async function(e,t){(async()=>{const r=e.body;r._id=new n.default.Types.ObjectId,r.ip=i.default.getIP(e),r.loginType=\"admin\";try{const e=await i.default.save(r);return t.status(s.default.CREATED).json(e.toAuthJSON())}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}})().then()},t.fetch=async function(e,t){const r=e.params.page?parseInt(e.params.page,10):1,n=e.params.limit?parseInt(e.params.limit,10):10;try{const e=await i.default.fetch({},r,n);return t.status(s.default.OK).json(e)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.fetchOne=async function(e,t){try{const r=await i.default.fetchOne({_id:e.params.id});return t.status(s.default.OK).json(r)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){const n=e.user;n.lastlogin=new Date,n.ip=i.default.getIP(e),n.loginType=\"admin\",n.loggedIn=!0,(async n=>{try{const a=await i.default.update({_id:n._id},n,{multi:!1});return a?(t.status(s.default.OK).json(e.user.toAuthJSON()),r()):(t.status(s.default.BAD_REQUEST).json({message:\"Unknown  error occurred!\"}),r())}catch(e){return t.status(s.default.BAD_REQUEST).json(e),r()}})(n).then()},t.update=async function(e,t){const r={name:e.body.name,email:e.body.email,type:e.body.type,avatar:e.body.avatar};try{const n=await i.default.update({_id:e.params.id},r);return t.status(s.default.OK).json(n)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.editPassword=async function(e,t){if(\"\"===e.body.pass1||\"\"===e.body.pass2||\"\"===e.body.password)return t.status(s.default.BAD_REQUEST).json({message:\"Please fill out all fields\"});if(e.body.pass1!==e.body.pass2)return t.status(s.default.BAD_REQUEST).json({message:\"Passwords do not match\"});let r=async r=>{try{const n=await i.default.update({_id:e.params.id},{password:r},{multi:!1});return t.status(s.default.OK).json(n)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};try{const n=await i.default.fetchOne({_id:e.params.id});if(!n)return t.status(s.default.BAD_REQUEST).json({message:\"You're not eligible to change the password\"});if(!a.default.compareSync(e.body.password,n.password))return t.status(s.default.BAD_REQUEST).json({message:\"Invalid old password\"});(async()=>{a.default.hash(e.body.pass1,null,null,(e,t)=>{r(t).then()})})().then()}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.deleteAdmin=async function(e,t){try{const r=await i.default.delete({_id:e.params.id});return t.status(s.default.OK).json(r)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var n=u(r(0)),a=u(r(6)),s=u(r(7)),i=u(r(8));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"mongoose-paginate\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"slug\")},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t){e.exports=require(\"ipware\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,a=r(11),s=(n=a)&&n.__esModule?n:{default:n};t.default={register:{body:{email:s.default.string().email().required(),password:s.default.string().regex(/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/).required(),type:s.default.string().required(),name:s.default.string().required()}}}},function(e,t){e.exports=require(\"passport-local\")},function(e,t){e.exports=require(\"passport-jwt\")}]);","extractedComments":[]}