{"code":"module.exports=function(e){var t={};function r(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=18)}([function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const s={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\",url:\"http://localhost:3000\"},a={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},n={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\",url:\"http://52.14.168.100:3000\"},i={PORT:process.env.PORT||3e3,twilio:{number:\"+12057429662\",accountSid:\"AC8a5fea6fb2f049b05bcbf3eaf330c38d\",authToken:\"b7bd7d0c620a0342b8a16bd0dfefde88\",authyKey:\"eXzYv8A8y5pn6q8W2taH67zBqhqsDtug\"},no_reply:\"no_reply@halalclothingonline.com\",amazon:{AccessKeyID:\"AKIAJRZ5NEHVHRBCCRQA\",SecretAccessKey:\"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\",region:\"us-east-1\"}};t.default={...i,...function(e){switch(e){case\"development\":return s;case\"test\":return a;default:return n}}(\"production\")}},function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"passport\")},function(e,t){e.exports=require(\"express-validation\")},function(e,t){e.exports=require(\"bcrypt-nodejs\")},function(e,t){e.exports=require(\"http-status\")},function(e,t){e.exports=require(\"joi\")},function(e,t,r){\"use strict\";const s=r(9).default,a=r(33)().get_ip;t.save=(async e=>{try{const t=new s(e);return await t.save()}catch(e){throw Error(e)}}),t.fetch=(async(e,t,r)=>{try{return await s.paginate(e,{page:t,limit:r,sort:{_id:\"asc\"}})}catch(e){throw Error(\"Error while paginating admins\")}}),t.fetchOne=(async e=>{try{return await s.findOne(e)}catch(e){throw Error(\"Error fetching admin\")}}),t.update=(async(e,t)=>{try{return await s.updateOne(e,{$set:t})}catch(e){throw Error(\"Error editing admin\")}}),t.delete=(async e=>{try{return await s.deleteOne(e)}catch(e){throw Error(\"Error deleting admin\")}}),t.getIP=(e=>{return a(e).clientIp})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=l(r(1)),a=l(r(31)),n=l(r(10)),i=l(r(5)),o=l(r(11)),d=l(r(0)),u=l(r(12));function l(e){return e&&e.__esModule?e:{default:e}}const c=s.default.Schema({name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>a.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:s.default.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});c.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),c.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return o.default.sign({_id:this._id,type:\"admin\"},d.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,type:this.type,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(e){return this.favorites.posts.indexOf(e)>=0?(this.favorites.posts.remove(e),await u.default.decFavoriteCount(e)):(this.favorites.posts.push(e),await u.default.incFavoriteCount(e)),this.save()},isPostIsFavorite(e){return this.favorites.posts.indexOf(e)>=0}}},c.plugin(n.default),t.default=s.default.model(\"Admin\",c)},function(e,t){e.exports=require(\"mongoose-paginate\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=i(r(1)),a=i(r(32)),n=i(r(13));function i(e){return e&&e.__esModule?e:{default:e}}const o=s.default.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:s.default.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});o.plugin(n.default,{message:\"{VALUE} already taken!\"}),o.pre(\"validate\",function(e){this._slugify(),e()}),o.methods={_slugify(){this.slug=(0,a.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},o.statics={createPost(e,t){return this.create({...e,user:t})},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate(\"user\")},incFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:1}})},decFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:-1}})}},t.default=s.default.model(\"Post\",o)},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.authJwt=t.authLocal=void 0;var s=d(r(3)),a=d(r(15)),n=r(16),i=r(8),o=d(r(0));function d(e){return e&&e.__esModule?e:{default:e}}const u=new a.default({usernameField:\"email\"},async(e,t,r)=>{try{const s=await(0,i.fetchOne)({email:e});return s&&s.authenticateUser(t)?r(null,s):r(null,!1)}catch(e){return r(e,!1)}}),l={jwtFromRequest:n.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:o.default.JWT_SECRET},c=new n.Strategy(l,async(e,t)=>{try{const r=await(0,i.fetchOne)({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});s.default.use(u),s.default.use(c);t.authLocal=s.default.authenticate(\"local\",{session:!1}),t.authJwt=s.default.authenticate(\"jwt\",{session:!1})},function(e,t){e.exports=require(\"passport-local\")},function(e,t){e.exports=require(\"passport-jwt\")},function(e,t,r){\"use strict\";var s=c(r(1)),a=c(r(10)),n=c(r(13)),i=c(r(5)),o=c(r(11)),d=c(r(43)),u=c(r(44)),l=c(r(0));function c(e){return e&&e.__esModule?e:{default:e}}const p=r(45)(l.default.twilio.authyKey),f=(0,u.default)(l.default.twilio.accountSid,l.default.twilio.authToken),y=s.default.Schema({username:{type:String,unique:!0,required:[!0,\"username is required!\"],trim:!0},fullName:{type:String,required:[!0,\"fullName is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0},password:{type:String,required:[!0,\"Password is required!\"],trim:!0,minlength:[4,\"Password need to be longer!\"]},phone:{type:String,unique:!0,required:[!0,\"Phone Number is required!\"],trim:!0},countryCode:{type:String,required:[!0,\"countryCode is required!\"],trim:!0},authyId:String,verified:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1},ip:String,resetPassword:{token:String,expire:Date},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},location:{type:String,required:!1,trim:!0},deviceToken:{type:String,required:!1,trim:!0},avatar:{},facebook:{id:{type:String,required:!1,trim:!0},token:{type:String,required:!1,trim:!0},fullname:{type:String,required:!1,trim:!0},avatar:{},expiration_date:{}},google:{token:{type:String,required:!1,trim:!0},fullname:{type:String,required:!1,trim:!0},email:{type:String,required:!1,trim:!0},avatar:{},expiration_date:{}}});y.pre(\"save\",async function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),this.ip||(this.ip=await this.getIP()),e()}),y.plugin(n.default,{message:\"{VALUE} already taken!\"}),y.methods={_hashPassword:e=>i.default.hashSync(e),authenticateUser(e){return i.default.compareSync(e,this.password)},createToken(){return o.default.sign({_id:this._id,type:\"user\"},l.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,location:this.location,facebook:this.facebook,google:this.google,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,username:this.username,fullName:this.fullName,email:this.email,phone:`${this.countryCode}${this.phone}`,location:this.location,facebook:this.facebook,google:this.google,avatar:this.avatar}},_login:{async save(){return this.ip=await this.getIP(),this.lastlogin=new Date,await this.save()}},getIP:()=>d.default.v4(),verifyAuthyToken(e,t){return p.verify(this.authyId,e,(e,r)=>t(e,r))},sendAuthyToken(e){function t(t){p.request_sms(t,!0,(t,r)=>e(t,r))}this.authyId?t(this.authyId):p.register_user(this.email,this.phone,this.countryCode,async(r,s)=>{if(r)return e(r,this);this.authyId=s.user.id,await this.save(),t(this.authyId)})},async sendMessage(e){return await f.sendMessage({to:`+${this.countryCode}${this.phone}`,from:l.default.twillio.number,body:e})}},y.plugin(a.default),e.exports=s.default.model(\"User\",y)},function(e,t,r){\"use strict\";var s=o(r(2)),a=o(r(0));r(19);var n=o(r(20)),i=o(r(28));function o(e){return e&&e.__esModule?e:{default:e}}const d=(0,s.default)();(0,n.default)(d),d.get(\"/\",(e,t)=>{t.send(\"Hello world!\")}),d.get(\"/reset_password\",(e,t)=>{t.send(`token: ${e.query.token}`)}),d.post(\"/email-notifications\",(e,t)=>{console.log(e.headers),t.status(200).json()}),(0,i.default)(d),d.listen(a.default.PORT,e=>{if(e)throw e;console.log(`Server running on port: ${a.default.PORT} - Running on production`)})},function(e,t,r){\"use strict\";var s=n(r(1)),a=n(r(0));function n(e){return e&&e.__esModule?e:{default:e}}s.default.Promise=global.Promise;try{s.default.connect(a.default.MONGO_URL)}catch(e){s.default.createConnection(a.default.MONGO_URL)}s.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});l(r(21));var s=r(22),a=l(r(23)),n=l(r(24)),i=l(r(3)),o=l(r(25)),d=l(r(26)),u=l(r(27));function l(e){return e&&e.__esModule?e:{default:e}}const c={customCss:\".swagger-ui .topbar { display: none }\"};t.default=(e=>{e.use((0,a.default)()),e.use((0,n.default)()),e.use((0,s.json)()),e.use((0,s.urlencoded)({extended:!0})),e.use((0,o.default)({credentials:!0,origin:!0})),e.use(i.default.initialize()),e.use(\"/api-docs\",d.default.serve,d.default.setup(u.default,c))})},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"helmet\")},function(e,t){e.exports=require(\"cors\")},function(e,t){e.exports=require(\"swagger-ui-express\")},function(e){e.exports={swagger:\"2.0\",info:{description:\"Api documentation for GooSendr. A logistics application.\",version:\"1.0.0\",title:\"GooSendr Api Documentation\",termsOfService:\"\",contact:{email:\"aditech5170@gmail.com\"}},host:\"52.14.168.100:3000\",basePath:\"/api/v1\",tags:[{name:\"user\",description:\"send me phone numbers to whiltelist for testing\",externalDocs:{description:\"\",url:\"http://52.14.168.100:3000/api/v1/user\"}}],schemes:[\"http\"],paths:{\"/user/register\":{post:{tags:[\"user\"],summary:\"Create user\",description:\"Refistering a new user.\",operationId:\"createUser\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Created user object\",required:!0,schema:{$ref:\"#/definitions/User\"}}],responses:{201:{description:\"OK\",schema:{$ref:\"#/definitions/AuthUserModel\"}},400:{description:\"\"}}}},\"/user/resend/{id}\":{get:{tags:[\"user\"],summary:\"Resend sms auth-Msg\",description:\"\",operationId:\"resend\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of regidtered user\",required:!0,type:\"string\"}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/verify/{id}\":{put:{tags:[\"user\"],summary:\"Send verification code\",description:\"\",operationId:\"verify\",produces:[\"application/json\"],parameters:[{in:\"path\",name:\"id\",description:\"id of regidtered user\",required:!0,type:\"string\"},{in:\"body\",name:\"body\",description:\"code received on phone\",required:!0,schema:{$ref:\"#/definitions/UserCodeModel\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/AuthUserModel\"}},400:{description:\"invalid code\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/login\":{post:{tags:[\"user\"],summary:\"Logs user into the system\",description:\"\",operationId:\"loginUser\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"user login information\",required:!0,schema:{$ref:\"#/definitions/UserLoginModel\"}}],responses:{200:{description:\"Ok\",schema:{$ref:\"#/definitions/AuthUserModel\"}},401:{description:\"UNAUTHORIZED\"}}}},\"/user/forgot-password\":{post:{tags:[\"user\"],summary:\"Forgot password\",description:\"\",operationId:\"forgotPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"The user email registered in the system. \",required:!0,schema:{$ref:\"#/definitions/ForgotPasswordModel\"}}],responses:{200:{description:\"OK\"},400:{description:\"UNAUTHORIZED\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/reset-password\":{post:{tags:[\"user\"],summary:\"Reset password with token from user's email\",description:\"\",operationId:\"resetPassword\",produces:[\"application/json\"],parameters:[{in:\"body\",name:\"body\",description:\"Token and Password\",required:!0,schema:{$ref:\"#/definitions/UserResetPasswordModel\"}}],responses:{200:{description:\"OK\"},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/change-password\":{patch:{tags:[\"user\"],summary:\"Changing of password\",description:\"This can only be done by the logged in user.\",operationId:\"changePassword\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/UserChangePasswordModel\"}}],security:[{Bearer:[]}],responses:{200:{description:\"OK\"},400:{description:\"invalid old password\"},401:{description:\"UNAUTHORIZED\"}}}},\"/user/update-user\":{patch:{tags:[\"user\"],summary:\"Update user Information\",description:\"This can only be done by the logged in user.\",operationId:\"updateUser\",produces:[\"application/json\"],parameters:[{name:\"body\",in:\"body\",required:!0,schema:{$ref:\"#/definitions/User\"}}],responses:{200:{description:\"OK\",schema:{$ref:\"#/definitions/UserModel\"}},400:{description:\"\"},401:{description:\"UNAUTHORIZED\"}},security:[{Bearer:[]}]}}},securityDefinitions:{Bearer:{type:\"apiKey\",name:\"Authorization\",in:\"header\"}},definitions:{User:{type:\"object\",properties:{username:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},password:{type:\"string\"},phone:{type:\"string\"},countryCode:{type:\"string\",description:\"eg +233\"},avatar:{type:\"object\"}}},UserModel:{type:\"object\",properties:{_id:{type:\"string\"},username:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},location:{type:\"string\"},facebook:{type:\"object\"},google:{type:\"object\"},avatar:{type:\"object\"}}},AuthUserModel:{type:\"object\",properties:{_id:{type:\"string\"},username:{type:\"string\"},fullName:{type:\"string\"},email:{type:\"string\"},phone:{type:\"string\"},location:{type:\"string\"},facebook:{type:\"object\"},google:{type:\"object\"},avatar:{type:\"object\"},token:{type:\"string\"}}},UserCodeModel:{type:\"object\",properties:{code:{type:\"string\"}}},UserResetPasswordModel:{type:\"object\",properties:{token:{type:\"string\"},newPassword:{type:\"string\"},verifyPassword:{type:\"string\"}}},UserChangePasswordModel:{type:\"object\",properties:{newPassword:{type:\"string\"},oldPassword:{type:\"string\"}}},UserLoginModel:{type:\"object\",properties:{email:{type:\"string\"},password:{type:\"string\"}}},ForgotPasswordModel:{type:\"object\",properties:{email:{type:\"string\"}}}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=i(r(29)),a=i(r(35)),n=i(r(38));function i(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use(\"/api/v1/admin\",s.default),e.use(\"/api/v1/posts\",a.default),e.use(\"/api/v1/user\",n.default)})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),a=d(r(4)),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(30)),i=d(r(34)),o=r(14);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/register\",(0,a.default)(i.default.register),n.AddAdmin),u.post(\"/login\",o.authLocal,n.login),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.AddAdmin=async function(e,t){(async()=>{const r=e.body;r._id=new s.default.Types.ObjectId,r.ip=i.default.getIP(e),r.loginType=\"admin\";try{const e=await i.default.save(r);return t.status(n.default.CREATED).json(e.toAuthJSON())}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}})().then()},t.fetch=async function(e,t){const r=e.params.page?parseInt(e.params.page,10):1,s=e.params.limit?parseInt(e.params.limit,10):10;try{const e=await i.default.fetch({},r,s);return t.status(n.default.OK).json(e)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.fetchOne=async function(e,t){try{const r=await i.default.fetchOne({_id:e.params.id});return t.status(n.default.OK).json(r)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){const s=e.user;s.lastlogin=new Date,s.ip=i.default.getIP(e),s.loginType=\"admin\",s.loggedIn=!0,(async s=>{try{const a=await i.default.update({_id:s._id},s,{multi:!1});return a?(t.status(n.default.OK).json(e.user.toAuthJSON()),r()):(t.status(n.default.BAD_REQUEST).json({message:\"Unknown  error occurred!\"}),r())}catch(e){return t.status(n.default.BAD_REQUEST).json(e),r()}})(s).then()},t.update=async function(e,t){const r={name:e.body.name,email:e.body.email,type:e.body.type,avatar:e.body.avatar};try{const s=await i.default.update({_id:e.params.id},r);return t.status(n.default.OK).json(s)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.editPassword=async function(e,t){if(\"\"===e.body.pass1||\"\"===e.body.pass2||\"\"===e.body.password)return t.status(n.default.BAD_REQUEST).json({message:\"Please fill out all fields\"});if(e.body.pass1!==e.body.pass2)return t.status(n.default.BAD_REQUEST).json({message:\"Passwords do not match\"});let r=async r=>{try{const s=await i.default.update({_id:e.params.id},{password:r},{multi:!1});return t.status(n.default.OK).json(s)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}};try{const s=await i.default.fetchOne({_id:e.params.id});if(!s)return t.status(n.default.BAD_REQUEST).json({message:\"You're not eligible to change the password\"});if(!a.default.compareSync(e.body.password,s.password))return t.status(n.default.BAD_REQUEST).json({message:\"Invalid old password\"});(async()=>{a.default.hash(e.body.pass1,null,null,(e,t)=>{r(t).then()})})().then()}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.deleteAdmin=async function(e,t){try{const r=await i.default.delete({_id:e.params.id});return t.status(n.default.OK).json(r)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}};var s=o(r(1)),a=o(r(5)),n=o(r(6)),i=o(r(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"slug\")},function(e,t){e.exports=require(\"ipware\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,a=r(7),n=(s=a)&&s.__esModule?s:{default:s};t.default={register:{body:{email:n.default.string().email().required(),password:n.default.string().regex(/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/).required(),type:n.default.string().required(),name:n.default.string().required()}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),a=d(r(4)),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(36)),i=d(r(37)),o=r(14);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/\",o.authJwt,(0,a.default)(i.default.createPost),n.createPost_),u.get(\"/:id\",o.authJwt,n.getPostById),u.get(\"/\",o.authJwt,n.getPostsList),u.patch(\"/:id\",o.authJwt,(0,a.default)(i.default.updatePost),n.updatePost),u.delete(\"/:id\",o.authJwt,n.deletePost),u.post(\"/:id/favorite\",o.authJwt,n.favoritePost),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.createPost_=async function(e,t){try{const r=await(0,a.createPost)(e.body,e.user._id);return t.status(s.default.CREATED).json(r)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.getPostById=async function(e,t){try{const r=await Promise.all([n.default.findById(e.user._id),(0,a.findById)(e.params.id).populate(\"user\")]),i=r[0]._favorites.isPostIsFavorite(e.params.id),o=r[1];return t.status(s.default.OK).json({...o.toJSON(),favorite:i})}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.getPostsList=async function(e,t){const r=parseInt(e.query.limit,0),i=parseInt(e.query.skip,0);try{const o=await Promise.all([n.default.findById(e.user._id),(0,a.list)({limit:r,skip:i})]),d=o[1].reduce((e,t)=>{const r=o[0]._favorites.isPostIsFavorite(t._id);return e.push({...t.toJSON(),favorite:r}),e},[]);return t.status(s.default.OK).json(d)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.updatePost=async function(e,t){try{const r=await(0,a.findById)(e.params.id);return r.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.default.OK).json(await r.save())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.deletePost=async function(e,t){try{const r=await(0,a.findById)(e.params.id);return r.user.equals(e.user._id)?(await r.remove(),t.sendStatus(s.default.OK)):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.favoritePost=async function(e,t){try{const r=await n.default.findById(e.user._id);return await r._favorites.posts(e.params.id),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var s=i(r(6)),a=r(12),n=i(r(9));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,a=r(7),n=(s=a)&&s.__esModule?s:{default:s};t.default={createPost:{body:{title:n.default.string().min(3).required(),text:n.default.string().min(10).required()}},updatePost:{body:{title:n.default.string().min(3),text:n.default.string().min(10)}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=r(2),a=d(r(4)),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}(r(39)),i=d(r(48)),o=r(49);function d(e){return e&&e.__esModule?e:{default:e}}const u=(0,s.Router)();u.post(\"/register\",(0,a.default)(i.default.register),n.createUser),u.get(\"/resend/:id\",n.resend),u.put(\"/verify/:id\",(0,a.default)(i.default.verify),n.verify),u.post(\"/login\",o.userAuthLocal,n.login),u.post(\"/forgot-password\",(0,a.default)(i.default.forgotPassword),n.forgotPassword),u.post(\"/reset-password\",(0,a.default)(i.default.resetPassword),n.resetPassword),u.patch(\"/change-password\",(0,a.default)(i.default.changePassword),o.userAuthJwt,n.changePassword),u.patch(\"/update-user\",(0,a.default)(i.default.update),o.userAuthJwt,n.updateUser),t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.createUser=async function(e,t){try{const r=await o.default.create(e.body),i=a.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"welcomeEmail.html\"),\"utf8\");r.sendAuthyToken(async a=>a?t.status(s.default.BAD_REQUEST).json(a):(await(0,d.default)({from:`GooSendr <${u.default.no_reply}>`,to:[e.body.email],subject:\"Welcome to GooSendr\",body:i}),t.status(s.default.CREATED).json(r.toAuthJSON())))}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resend=async function(e,t){try{const r=await o.default.findById(e.params.id);if(!r)return t.sendStatus(s.default.UNAUTHORIZED);r.sendAuthyToken(async e=>e?t.status(s.default.BAD_REQUEST).json(e):t.sendStatus(s.default.OK))}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.verify=async function(e,t){try{const r=await o.default.findById(e.params.id);if(!r)return t.sendStatus(s.default.UNAUTHORIZED);r.verifyAuthyToken(e.body.code,async e=>e?t.status(s.default.BAD_REQUEST).json({messge:\"invalid code\"}):(r.verified=!0,await r.save(),t.status(s.default.OK).json(r.toAuthJSON())))}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.login=async function(e,t,r){return await e.user._login.save(),t.status(s.default.OK).json(e.user.toAuthJSON()),r()},t.forgotPassword=async function(e,t){try{const r=await o.default.findOne({email:e.body.email});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);const a=i.default.randomBytes(20),n=a.toString(\"hex\");await o.default.findByIdAndUpdate({_id:r._id},{\"resetPassword.token\":n,\"resetPassword.expire\":new Date(+new Date+864e5)});const l=`${c}\\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\"><tbody class=\"mcnTextBlockOuter\"><tr><td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\"><table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\"><tbody><tr><td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\"><h1 id=\"_name\" style=\"text-align: left;\">\\n    <span style=\"font-size:24px\">Hello ${r.username}</span>\\n    </h1></td></tr></tbody></table></td></tr></tbody></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnDividerBlock\" style=\"min-width:100%;\"><tbody class=\"mcnDividerBlockOuter\"><tr><td class=\"mcnDividerBlockInner\" style=\"min-width: 100%; padding: 18px 18px 0px;\"><table class=\"mcnDividerContent\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"min-width:100%;\"><tbody><tr><td> <span></span></td></tr></tbody></table></td></tr></tbody></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\"><tbody class=\"mcnTextBlockOuter\"><tr><td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\"><table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\"><tbody><tr><td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\"><p align=\"left\"> <span style=\"color:#000000\"> We're sorry you're having trouble logging into your <span class=\"il\">gooSendr</span> account. We're happy to be of service, just click on the forget my password link.\\n    <a href=\"${u.default.url}'+/reset_password?token=${n}\" target=\"_blank\">reset password</a>\\n    </span></p><p align=\"left\"> <span style=\"color:#000000\"> <strong>This link is only valid for 24 hours.</strong> </span></p><p align=\"left\"> <span style=\"color:#000000\"> If you didn't ask us for help with your password,send an email to <a>support@<span class=\"il\">gooltd</span>.com</a> or call us at <strong>(+233)-20-051 6773</strong>. </span></p><p align=\"left\"><span style=\"color:#000000\">Reporting, it is important because it helps us prevent fraudsters from stealing your information</span></p></td></tr></tbody></table></td></tr></tbody></table>\\n    ${p}`;return await(0,d.default)({from:`GooSendr <${u.default.no_reply}>`,to:[e.body.email],subject:\"GooSendr Password Reset\",body:l}),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.resetPassword=async function(e,t){try{const r=await o.default.findOne({\"resetPassword.token\":e.body.token,\"resetPassword.expire\":{$gt:Date.now()}});if(!r)return t.sendStatus(s.default.UNAUTHORIZED);if(e.body.newPassword!==e.body.verifyPassword)return t.status(s.default.BAD_REQUEST).json({messge:\"Passwords do not match\"});r.password=e.body.newPassword,r.resetPassword.token=void 0,r.resetPassword.expire=void 0,await r.save();const a=`${c}\\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\"><tbody class=\"mcnTextBlockOuter\"><tr><td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\"><table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\"><tbody><tr><td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\"><h1 id=\"_name\" style=\"text-align: left;\">\\n    <span style=\"font-size:24px\">Hello ${r.username}</span>\\n    </h1></td></tr></tbody></table></td></tr></tbody></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"\\n    class=\"mcnDividerBlock\" style=\"min-width:100%;\"><tbody class=\"mcnDividerBlockOuter\"><tr><td class=\"mcnDividerBlockInner\"\\n    style=\"min-width: 100%; padding: 18px 18px 0px;\"><table class=\"mcnDividerContent\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"\\n     width=\"100%\" style=\"min-width:100%;\"><tbody><tr><td> <span></span></td></tr></tbody></table></td></tr></tbody></table><table\\n      border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"mcnTextBlock\" style=\"min-width:100%;\"><tbody\\n      class=\"mcnTextBlockOuter\"><tr><td valign=\"top\" class=\"mcnTextBlockInner\" style=\"padding-top:9px;\"><table align=\"left\" border=\"0\"\\n       cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:100%; min-width:100%;\" width=\"100%\" class=\"mcnTextContentContainer\"><tbody>\\n       <tr><td valign=\"top\" class=\"mcnTextContent\" style=\"padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;\">\\n       <p align=\"left\"> <span style=\"color:#000000\">\\n       You just changed your password.<br /> If you didn't change your password, give us a call right away at <strong>(+233)-20-051 6773</strong>\\n       </span></p>\\n       <p>Just a reminder:</p><ul>\\n       <li style=\"text-indent: 0px;margin-left: 28px;\">Never share your password with anyone.</li>\\n       <li style=\"text-indent: 0px;margin-left: 28px;\">\\n       Create passwords that are hard to guess and don't use personal information. Be sure to include uppercase and lowercase letters, numbers, and symbols.</li></ul>\\n      </td></tr></tbody></table></td></tr></tbody></table>\\n    ${p}`;return await(0,d.default)({from:`GooSendr <${u.default.no_reply}>`,to:[r.email],subject:\"Your password has been changed\",body:a}),t.sendStatus(s.default.OK)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.changePassword=async function(e,t){try{const r=await o.default.findById(e.user._id);return r?r.authenticateUser(e.body.oldPassword)?(r.password=e.body.newPassword,await r.save(),t.sendStatus(s.default.OK)):t.status(s.default.BAD_REQUEST).json({messge:\"invalid old password\"}):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}},t.updateUser=async function(e,t){try{const r=await o.default.findById(e.user._id);return r?(Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.default.OK).json(await r.save())):t.sendStatus(s.default.UNAUTHORIZED)}catch(e){return t.status(s.default.BAD_REQUEST).json(e)}};var s=l(r(6)),a=l(r(40)),n=l(r(41)),i=l(r(42)),o=l(r(17)),d=l(r(46)),u=l(r(0));function l(e){return e&&e.__esModule?e:{default:e}}const c=a.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"header.html\"),\"utf8\"),p=a.default.readFileSync(n.default.join(n.default.resolve(\"./src/public\"),\"footer.html\"),\"utf8\")},function(e,t){e.exports=require(\"fs\")},function(e,t){e.exports=require(\"path\")},function(e,t){e.exports=require(\"crypto\")},function(e,t){e.exports=require(\"public-ip\")},function(e,t){e.exports=require(\"twilio\")},function(e,t){e.exports=require(\"authy\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){s.default.config.update({accessKeyId:a.default.amazon.AccessKeyID,secretAccessKey:a.default.amazon.SecretAccessKey,region:a.default.amazon.region});const t=new s.default.SES({apiVersion:\"latest\"});return new Promise((r,s)=>{t.sendEmail({Source:e.from,Destination:{CcAddresses:e.cc,ToAddresses:e.to},Message:{Subject:{Data:e.subject},Body:{Html:{Data:e.body}}},ReplyToAddresses:e.replyTo},(e,t)=>{e?s(e):r(t)})})};var s=n(r(47)),a=n(r(0));function n(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require(\"aws-sdk\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s,a=r(7),n=(s=a)&&s.__esModule?s:{default:s};const i=/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;t.default={register:{body:{username:n.default.string().required(),fullName:n.default.string().required(),email:n.default.string().email().required(),password:n.default.string().regex(i).required(),phone:n.default.number().required(),countryCode:n.default.string().required()}},update:{body:{username:n.default.string(),firstName:n.default.string(),lastName:n.default.string(),email:n.default.string().email(),phone:n.default.string()}},verify:{body:{code:n.default.string().required()}},forgotPassword:{body:{email:n.default.string().required()}},resetPassword:{body:{token:n.default.string().required(),newPassword:n.default.string().regex(i).required(),verifyPassword:n.default.string().required()}},changePassword:{body:{oldPassword:n.default.string().required(),newPassword:n.default.string().regex(i).required()}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.userAuthJwt=t.userAuthLocal=void 0;var s=d(r(3)),a=d(r(15)),n=r(16),i=d(r(17)),o=d(r(0));function d(e){return e&&e.__esModule?e:{default:e}}const u=new a.default({usernameField:\"email\"},async(e,t,r)=>{try{const s=await i.default.findOne({email:e});return s&&s.authenticateUser(t)?r(null,s):r(null,!1)}catch(e){return r(e,!1)}}),l={jwtFromRequest:n.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:o.default.JWT_SECRET},c=new n.Strategy(l,async(e,t)=>{try{const r=await i.default.findOne({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});s.default.use(u),s.default.use(c);t.userAuthLocal=s.default.authenticate(\"local\",{session:!1}),t.userAuthJwt=s.default.authenticate(\"jwt\",{session:!1})}]);","extractedComments":[]}