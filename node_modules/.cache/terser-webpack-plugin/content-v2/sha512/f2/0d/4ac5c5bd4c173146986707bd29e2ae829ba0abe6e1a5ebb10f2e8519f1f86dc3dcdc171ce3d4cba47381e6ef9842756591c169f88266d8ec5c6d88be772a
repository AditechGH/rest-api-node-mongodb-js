{"code":"module.exports=function(t){var e={};function r(a){if(e[a])return e[a].exports;var s=e[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var s in t)r.d(a,s,function(e){return t[e]}.bind(null,s));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,\"a\",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p=\"\",r(r.s=12)}([function(t,e){t.exports=require(\"mongoose\")},function(t,e){t.exports=require(\"express\")},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const a={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\"},s={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},n={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\"},u={PORT:process.env.PORT||3e3};e.default={...u,...function(t){switch(t){case\"development\":return a;case\"test\":return s;default:return n}}(\"production\")}},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.authJwt=e.authLocal=void 0;var a=i(r(4)),s=i(r(29)),n=r(30),u=r(8);function i(t){return t&&t.__esModule?t:{default:t}}const o=new s.default({usernameField:\"email\"},async(t,e,r)=>{try{const a=await(0,u.fetchOne)({email:t});return a&&a.authenticateUser(e)?r(null,a):r(null,!1)}catch(t){return r(t,!1)}}),d={jwtFromRequest:n.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:\"JWT_SECRET\"},l=new n.Strategy(d,async(t,e)=>{try{const r=await(0,u.fetchOne)({_id:t._id});return e(null,r?r:!1)}catch(t){return e(t,!1)}});a.default.use(o),a.default.use(l);e.authLocal=a.default.authenticate(\"local\",{session:!1}),e.authJwt=a.default.authenticate(\"jwt\",{session:!1})},function(t,e){t.exports=require(\"passport\")},function(t,e){t.exports=require(\"express-validation\")},function(t,e){t.exports=require(\"bcrypt-nodejs\")},function(t,e){t.exports=require(\"http-status\")},function(t,e,r){\"use strict\";const a=r(9).default,s=r(27)().get_ip;e.save=(async t=>{try{const e=new a(t);return await e.save()}catch(t){throw Error(t)}}),e.fetch=(async(t,e,r)=>{try{return await a.paginate(t,{page:e,limit:r,sort:{_id:\"asc\"}})}catch(t){throw Error(\"Error while paginating admins\")}}),e.fetchOne=(async t=>{try{return await a.findOne(t)}catch(t){throw Error(\"Error fetching admin\")}}),e.update=(async(t,e)=>{try{return await a.updateOne(t,{$set:e})}catch(t){throw Error(\"Error editing admin\")}}),e.delete=(async t=>{try{return await a.deleteOne(t)}catch(t){throw Error(\"Error deleting admin\")}}),e.getIP=(t=>{return s(t).clientIp})},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=d(r(0)),s=d(r(22)),n=d(r(23)),u=d(r(6)),i=d(r(24)),o=d(r(10));function d(t){return t&&t.__esModule?t:{default:t}}const l=a.default.Schema({name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:t=>s.default.isEmail(t),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:a.default.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});l.pre(\"save\",function(t){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),t()}),l.methods={_hashPassword:t=>u.default.hashSync(t),authenticateUser(t){return u.default.compareSync(t,this.password)},createToken(){return i.default.sign({_id:this._id},\"JWT_SECRET\")},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,password:this.password,type:this.type,ip:this.ip,signup:this.signup,lastlogin:this.lastlogin,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(t){return this.favorites.posts.indexOf(t)>=0?(this.favorites.posts.remove(t),await o.default.decFavoriteCount(t)):(this.favorites.posts.push(t),await o.default.incFavoriteCount(t)),this.save()},isPostIsFavorite(t){return this.favorites.posts.indexOf(t)>=0}}},l.plugin(n.default),e.default=a.default.model(\"Admin\",l)},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=u(r(0)),s=u(r(25)),n=u(r(26));function u(t){return t&&t.__esModule?t:{default:t}}const i=a.default.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:a.default.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});i.plugin(n.default,{message:\"{VALUE} already taken!\"}),i.pre(\"validate\",function(t){this._slugify(),t()}),i.methods={_slugify(){this.slug=(0,s.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},i.statics={createPost(t,e){return this.create({...t,user:e})},list({skip:t=0,limit:e=5}={}){return this.find().sort({createdAt:-1}).skip(t).limit(e).populate(\"user\")},incFavoriteCount(t){return this.findByIdAndUpdate(t,{$inc:{favoriteCount:1}})},decFavoriteCount(t){return this.findByIdAndUpdate(t,{$inc:{favoriteCount:-1}})}},e.default=a.default.model(\"Post\",i)},function(t,e){t.exports=require(\"joi\")},function(t,e,r){\"use strict\";var a=i(r(1)),s=i(r(2));r(13);var n=i(r(14)),u=i(r(19));function i(t){return t&&t.__esModule?t:{default:t}}const o=(0,a.default)();(0,n.default)(o),o.get(\"/\",(t,e)=>{e.send(\"Hello world!\")}),(0,u.default)(o),o.listen(s.default.PORT,t=>{if(t)throw t;console.log(`Server running on port: ${s.default.PORT}\\n\\n    -- - Running on production`)})},function(t,e,r){\"use strict\";var a=n(r(0)),s=n(r(2));function n(t){return t&&t.__esModule?t:{default:t}}a.default.Promise=global.Promise;try{a.default.connect(s.default.MONGO_URL)}catch(t){a.default.createConnection(s.default.MONGO_URL)}a.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",t=>{throw t})},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});i(r(15));var a=r(16),s=i(r(17)),n=i(r(18)),u=i(r(4));function i(t){return t&&t.__esModule?t:{default:t}}e.default=(t=>{t.use((0,s.default)()),t.use((0,n.default)()),t.use((0,a.json)()),t.use((0,a.urlencoded)({extended:!0})),t.use(u.default.initialize())})},function(t,e){t.exports=require(\"morgan\")},function(t,e){t.exports=require(\"body-parser\")},function(t,e){t.exports=require(\"compression\")},function(t,e){t.exports=require(\"helmet\")},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=u(r(20)),s=u(r(31)),n=u(r(3));function u(t){return t&&t.__esModule?t:{default:t}}e.default=(t=>{t.use(\"/api/v1/admin\",a.default),t.use(\"/api/v1/posts\",s.default),t.get(\"/hello\",n.default,(t,e)=>{e.send(\"This is a private route!!!!\")})})},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=r(1),s=o(r(5)),n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};a.get||a.set?Object.defineProperty(e,r,a):e[r]=t[r]}return e.default=t,e}(r(21)),u=o(r(28)),i=o(r(3));function o(t){return t&&t.__esModule?t:{default:t}}const d=(0,a.Router)();d.post(\"/register\",(0,s.default)(u.default.register),n.AddAdmin),d.post(\"/login\",i.default,n.login),e.default=d},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.AddAdmin=async function(t,e){(async()=>{const r=t.body;r._id=new a.default.Types.ObjectId,r.ip=u.default.getIP(t),r.loginType=\"admin\";try{const t=await u.default.save(r);return e.status(n.default.CREATED).json(t.toAuthJSON())}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}})().then()},e.fetch=async function(t,e){const r=t.params.page?parseInt(t.params.page,10):1,a=t.params.limit?parseInt(t.params.limit,10):10;try{const t=await u.default.fetch({},r,a);return e.status(n.default.OK).json(t)}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}},e.fetchOne=async function(t,e){try{const r=await u.default.fetchOne({_id:t.params.id});return e.status(n.default.OK).json(r)}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}},e.login=async function(t,e,r){const a=t.user;a.lastlogin=new Date,a.ip=u.default.getIP(t),a.loginType=\"admin\",a.loggedIn=!0,(async a=>{try{const s=await u.default.update({_id:a._id},a,{multi:!1});return s?(e.status(n.default.OK).json(t.user.toAuthJSON()),r()):(e.status(n.default.BAD_REQUEST).json({message:\"Unknown  error occurred!\"}),r())}catch(t){return e.status(n.default.BAD_REQUEST).json(t),r()}})(a).then()},e.update=async function(t,e){const r={name:t.body.name,email:t.body.email,type:t.body.type,avatar:t.body.avatar};try{const a=await u.default.update({_id:t.params.id},r);return e.status(n.default.OK).json(a)}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}},e.editPassword=async function(t,e){if(\"\"===t.body.pass1||\"\"===t.body.pass2||\"\"===t.body.password)return e.status(n.default.BAD_REQUEST).json({message:\"Please fill out all fields\"});if(t.body.pass1!==t.body.pass2)return e.status(n.default.BAD_REQUEST).json({message:\"Passwords do not match\"});let r=async r=>{try{const a=await u.default.update({_id:t.params.id},{password:r},{multi:!1});return e.status(n.default.OK).json(a)}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}};try{const a=await u.default.fetchOne({_id:t.params.id});if(!a)return e.status(n.default.BAD_REQUEST).json({message:\"You're not eligible to change the password\"});if(!s.default.compareSync(t.body.password,a.password))return e.status(n.default.BAD_REQUEST).json({message:\"Invalid old password\"});(async()=>{s.default.hash(t.body.pass1,null,null,(t,e)=>{r(e).then()})})().then()}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}},e.deleteAdmin=async function(t,e){try{const r=await u.default.delete({_id:t.params.id});return e.status(n.default.OK).json(r)}catch(t){return e.status(n.default.BAD_REQUEST).json(t)}};var a=i(r(0)),s=i(r(6)),n=i(r(7)),u=i(r(8));function i(t){return t&&t.__esModule?t:{default:t}}},function(t,e){t.exports=require(\"validator\")},function(t,e){t.exports=require(\"mongoose-paginate\")},function(t,e){t.exports=require(\"jsonwebtoken\")},function(t,e){t.exports=require(\"slug\")},function(t,e){t.exports=require(\"mongoose-unique-validator\")},function(t,e){t.exports=require(\"ipware\")},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a,s=r(11),n=(a=s)&&a.__esModule?a:{default:a};e.default={register:{body:{email:n.default.string().email().required(),password:n.default.string().regex(/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/).required(),type:n.default.string().required(),name:n.default.string().required()}}}},function(t,e){t.exports=require(\"passport-local\")},function(t,e){t.exports=require(\"passport-jwt\")},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=r(1),s=o(r(5)),n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};a.get||a.set?Object.defineProperty(e,r,a):e[r]=t[r]}return e.default=t,e}(r(32)),u=o(r(33)),i=o(r(3));function o(t){return t&&t.__esModule?t:{default:t}}const d=(0,a.Router)();d.post(\"/\",i.default,(0,s.default)(u.default.createPost),n.createPost_),d.get(\"/:id\",i.default,n.getPostById),d.get(\"/\",i.default,n.getPostsList),d.patch(\"/:id\",i.default,(0,s.default)(u.default.updatePost),n.updatePost),d.delete(\"/:id\",i.default,n.deletePost),d.post(\"/:id/favorite\",i.default,n.favoritePost),e.default=d},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.createPost_=async function(t,e){try{const r=await(0,s.createPost)(t.body,t.user._id);return e.status(a.default.CREATED).json(r)}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}},e.getPostById=async function(t,e){try{const r=await Promise.all([n.default.findById(t.user._id),(0,s.findById)(t.params.id).populate(\"user\")]),u=r[0]._favorites.isPostIsFavorite(t.params.id),i=r[1];return e.status(a.default.OK).json({...i.toJSON(),favorite:u})}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}},e.getPostsList=async function(t,e){const r=parseInt(t.query.limit,0),u=parseInt(t.query.skip,0);try{const i=await Promise.all([n.default.findById(t.user._id),(0,s.list)({limit:r,skip:u})]),o=i[1].reduce((t,e)=>{const r=i[0]._favorites.isPostIsFavorite(e._id);return t.push({...e.toJSON(),favorite:r}),t},[]);return e.status(a.default.OK).json(o)}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}},e.updatePost=async function(t,e){try{const r=await(0,s.findById)(t.params.id);return r.user.equals(t.user._id)?(Object.keys(t.body).forEach(e=>{r[e]=t.body[e]}),e.status(a.default.OK).json(await r.save())):e.sendStatus(a.default.UNAUTHORIZED)}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}},e.deletePost=async function(t,e){try{const r=await(0,s.findById)(t.params.id);return r.user.equals(t.user._id)?(await r.remove(),e.sendStatus(a.default.OK)):e.sendStatus(a.default.UNAUTHORIZED)}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}},e.favoritePost=async function(t,e){try{const r=await n.default.findById(t.user._id);return await r._favorites.posts(t.params.id),e.sendStatus(a.default.OK)}catch(t){return e.status(a.default.BAD_REQUEST).json(t)}};var a=u(r(7)),s=r(10),n=u(r(9));function u(t){return t&&t.__esModule?t:{default:t}}},function(t,e,r){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a,s=r(11),n=(a=s)&&a.__esModule?a:{default:a};e.default={createPost:{body:{title:n.default.string().min(3).required(),text:n.default.string().min(10).required()}},updatePost:{body:{title:n.default.string().min(3),text:n.default.string().min(10)}}}}]);","extractedComments":[]}