{"code":"module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=13)}([function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const o={MONGO_URL:\"mongodb://localhost/goosendr-dev\",JWT_SECRET:process.env.SECRET||\"Aditek\"},s={MONGO_URL:\"mongodb://localhost/goosendr-test\",JWT_SECRET:process.env.SECRET||\"Aditek\"},n={MONGO_URL:\"mongodb://localhost/goosendr-prod\",JWT_SECRET:process.env.SECRET||\"Aditek\"},i={PORT:process.env.PORT||3e3};t.default={...i,...function(e){switch(e){case\"development\":return o;case\"test\":return s;default:return n}}(\"production\")}},function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var o,s=r(4),n=r(30),i=(o=n)&&o.__esModule?o:{default:o},a=r(12),d=r(6),u=r(0);const c={jwtFromRequest:a.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:u.JWT_SECRET},l=new i.default({usernameField:\"email\"},async(e,t,r)=>{try{const o=await(0,d.fetchOne)({email:e});return o&&o.authenticateUser(t)?r(null,o):r(null,!1)}catch(e){return r(e,!1)}}),m=new a.Strategy(c,async(e,t)=>{try{const r=await(0,d.fetchOne)({_id:e._id});return t(null,r?r:!1)}catch(e){return t(e,!1)}});(0,s.use)(l),(0,s.use)(m);const p=(0,s.authenticate)(\"local\",{session:!1}),f=(0,s.authenticate)(\"jwt\",{session:!1});t.default={authLocal:p,authJwt:f}},function(e,t){e.exports=require(\"passport\")},function(e,t){e.exports=require(\"express-validation\")},function(e,t,r){\"use strict\";const o=r(7),s=r(28)().get_ip;t.save=(async e=>{try{const t=new o(e);return await t.save()}catch(e){throw Error(e)}}),t.fetch=(async(e,t,r)=>{try{return await o.paginate(e,{page:t,limit:r,sort:{_id:\"asc\"}})}catch(e){throw Error(\"Error while paginating admins\")}}),t.fetchOne=(async e=>{try{return await o.findOne(e)}catch(e){throw Error(\"Error fetching admin\")}}),t.update=(async(e,t)=>{try{return await o.updateOne(e,{$set:t})}catch(e){throw Error(\"Error editing admin\")}}),t.delete=(async e=>{try{return await o.deleteOne(e)}catch(e){throw Error(\"Error deleting admin\")}}),t.getIP=(e=>{return s(e).clientIp})},function(e,t,r){\"use strict\";const o=r(1),s=r(23),n=r(24),i=r(8),a=r(25),d=r(0),u=r(9),c=new o.Schema({_id:{type:o.Schema.Types.ObjectId,required:!0},name:{type:String,required:[!0,\"Name is required!\"],trim:!0},email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>s.isEmail(e),message:\"{VALUE} is not a valid email!\"}},password:{type:String,required:[!0,\"Password is required!\"],trim:!0},favorites:{posts:[{type:o.Schema.Types.ObjectId,ref:\"Post\"}]},type:{type:String,required:[!0,\"Admin Type is required!\"],trim:!0},ip:{type:String,required:!0,trim:!0},signup:{type:Date,default:Date.now},lastlogin:{type:Date,default:Date.now},notescheck:{type:Date,default:Date.now},loggedIn:{type:Boolean,default:!1},avatar:{},token:{type:String,required:!1,trim:!0},loginType:{type:String,default:\"admin\"},expire:{type:String,required:!1,trim:!0}});c.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),c.methods={_hashPassword:e=>i.hashSync(e),authenticateUser(e){return i.compareSync(e,this.password)},createToken(){return a.sign({_id:this._id},d.JWT_SECRET)},toAuthJSON(){return{_id:this._id,name:this.name,email:this.email,password:this.password,type:this.type,ip:this.ip,signup:this.signup,lastlogin:this.lastlogin,avatar:this.avatar,token:`bearer ${this.createToken()}`}},toJSON(){return{_id:this._id,name:this.name,email:this.email,avatar:this.avatar}},_favorites:{async posts(e){return this.favorites.posts.indexOf(e)>=0?(this.favorites.posts.remove(e),await u.decFavoriteCount(e)):(this.favorites.posts.push(e),await u.incFavoriteCount(e)),this.save()},isPostIsFavorite(e){return this.favorites.posts.indexOf(e)>=0}}},c.plugin(n),e.exports=o.model(\"Admin\",c)},function(e,t){e.exports=require(\"bcrypt-nodejs\")},function(e,t,r){\"use strict\";const o=r(1),s=r(26),n=r(27),i=o.Schema({title:{type:String,trim:!0,required:[!0,\"Title is required!\"],minlength:[3,\"Title need to be longer!\"],unique:!0},text:{type:String,trim:!0,required:[!0,\"Text is required!\"],minlength:[10,\"Text need to be longer!\"]},slug:{type:String,trim:!0,lowercase:!0},user:{type:o.Schema.Types.ObjectId,ref:\"Admin\"},favoriteCount:{type:Number,default:0}},{timestamps:!0});i.plugin(n,{message:\"{VALUE} already taken!\"}),i.pre(\"validate\",function(e){this._slugify(),e()}),i.methods={_slugify(){this.slug=s(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,createdAt:this.createdAt,slug:this.slug,user:this.user,favoriteCount:this.favoriteCount}}},i.statics={createPost(e,t){return this.create({...e,user:t})},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate(\"user\")},incFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:1}})},decFavoriteCount(e){return this.findByIdAndUpdate(e,{$inc:{favoriteCount:-1}})}},e.exports=o.model(\"Post\",i)},function(e,t){e.exports=require(\"http-status\")},function(e,t){e.exports=require(\"joi\")},function(e,t){e.exports=require(\"passport-jwt\")},function(e,t,r){\"use strict\";var o=a(r(2)),s=a(r(0));r(14);var n=a(r(15)),i=a(r(20));function a(e){return e&&e.__esModule?e:{default:e}}const d=(0,o.default)();(0,n.default)(d),d.get(\"/\",(e,t)=>{t.send(\"Hello world!\")}),(0,i.default)(d),d.listen(s.default.PORT,e=>{if(e)throw e;console.log(`Server running on port: ${s.default.PORT}\\n\\n    -- - Running on production`)})},function(e,t,r){\"use strict\";var o=n(r(1)),s=n(r(0));function n(e){return e&&e.__esModule?e:{default:e}}o.default.Promise=global.Promise;try{o.default.connect(s.default.MONGO_URL)}catch(e){o.default.createConnection(s.default.MONGO_URL)}o.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});a(r(16));var o=r(17),s=a(r(18)),n=a(r(19)),i=r(4);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use((0,s.default)()),e.use((0,n.default)()),e.use((0,o.json)()),e.use((0,o.urlencoded)({extended:!0})),e.use((0,i.initialize)())})},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"helmet\")},function(e,t,r){\"use strict\";const o=r(21),s=r(31),{authJwt:n}=r(3).default;e.exports=(e=>{e.use(\"/api/v1/admin\",o),e.use(\"/api/v1/posts\",s),e.get(\"/hello\",n,(e,t)=>{t.send(\"This is a private route!!!!\")})})},function(e,t,r){\"use strict\";const o=r(2),s=r(5),n=r(22),i=o.Router(),a=r(29),{authLocal:d}=r(3).default;i.post(\"/register\",s(a.register),n.save),i.post(\"/login\",d,n.login),e.exports=i},function(e,t){throw new Error(\"Module build failed (from ./node_modules/babel-loader/lib/index.js):\\nTypeError: C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\src\\\\modules\\\\admin\\\\admin.controllers.js: Duplicate declaration \\\"mongoose\\\"\\n\u001b[0m \u001b[90m 4 | \u001b[39m\u001b[36mconst\u001b[39m bcrypt \u001b[33m=\u001b[39m require(\u001b[32m'bcrypt-nodejs'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\\n\u001b[0m \u001b[90m 5 | \u001b[39m\u001b[0m\\n\u001b[0m\u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 6 | \u001b[39m\u001b[36mimport\u001b[39m mongoose from \u001b[32m'mongoose'\u001b[39m\u001b[33m;\u001b[39m\u001b[0m\\n\u001b[0m \u001b[90m   | \u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\u001b[0m\\n\u001b[0m \u001b[90m 7 | \u001b[39m\u001b[0m\\n\u001b[0m \u001b[90m 8 | \u001b[39m\u001b[36mconst\u001b[39m \u001b[33mHTTPStatus\u001b[39m \u001b[33m=\u001b[39m require(\u001b[32m'http-status'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\\n\u001b[0m \u001b[90m 9 | \u001b[39m\u001b[0m\\n    at File.buildCodeFrameError (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transformation\\\\file\\\\file.js:261:12)\\n    at Scope.checkBlockScopedCollisions (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:346:22)\\n    at Scope.registerBinding (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:503:16)\\n    at Scope.registerDeclaration (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:451:14)\\n    at Object.Declaration (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:125:12)\\n    at NodePath._call (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\context.js:53:20)\\n    at NodePath.call (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\context.js:40:17)\\n    at NodePath.visit (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\context.js:88:12)\\n    at TraversalContext.visitQueue (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\context.js:118:16)\\n    at TraversalContext.visitMultiple (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\context.js:85:17)\\n    at TraversalContext.visit (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\context.js:144:19)\\n    at Function.traverse.node (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\index.js:94:17)\\n    at traverse (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\index.js:76:12)\\n    at NodePath.traverse (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\index.js:161:24)\\n    at Scope.crawl (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:683:10)\\n    at Scope.init (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\scope\\\\index.js:633:32)\\n    at NodePath.setScope (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\context.js:126:30)\\n    at NodePath.setContext (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\node_modules\\\\@babel\\\\traverse\\\\lib\\\\path\\\\context.js:141:8)\\n    at new File (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transformation\\\\file\\\\file.js:104:8)\\n    at normalizeFile (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transformation\\\\normalize-file.js:141:10)\\n    at runSync (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transformation\\\\index.js:44:43)\\n    at runAsync (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transformation\\\\index.js:35:14)\\n    at process.nextTick (C:\\\\Users\\\\amatsii-dev\\\\Documents\\\\Projects\\\\node\\\\GooSendr\\\\node_modules\\\\@babel\\\\core\\\\lib\\\\transform.js:34:34)\\n    at process._tickCallback (internal/process/next_tick.js:61:11)\")},function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"mongoose-paginate\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"slug\")},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t){e.exports=require(\"ipware\")},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var o,s=r(11),n=(o=s)&&o.__esModule?o:{default:o};t.default={register:{body:{email:n.default.string().email().required(),password:n.default.string().regex(/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/).required(),type:n.default.string().required(),name:n.default.string().required()}}}},function(e,t){e.exports=require(\"passport-local\")},function(e,t,r){\"use strict\";const o=r(2),s=r(5),n=r(32),i=o.Router(),a=r(33),{authJwt:d}=r(3).default;i.post(\"/\",d,s(a.createPost),n.createPost),i.get(\"/:id\",d,n.getPostById),i.get(\"/\",d,n.getPostsList),i.patch(\"/:id\",d,s(a.updatePost),n.updatePost),i.delete(\"/:id\",d,n.deletePost),i.post(\"/:id/favorite\",d,n.favoritePost),e.exports=i},function(e,t,r){\"use strict\";const o=r(9),s=r(10),n=r(7);t.createPost=(async(e,t)=>{try{const r=await o.createPost(e.body,e.user._id);return t.status(s.CREATED).json(r)}catch(e){return t.status(s.BAD_REQUEST).json(e)}}),t.getPostById=(async(e,t)=>{try{const r=await Promise.all([n.findById(e.user._id),o.findById(e.params.id).populate(\"user\")]),i=r[0]._favorites.isPostIsFavorite(e.params.id),a=r[1];return t.status(s.OK).json({...a.toJSON(),favorite:i})}catch(e){return t.status(s.BAD_REQUEST).json(e)}}),t.getPostsList=(async(e,t)=>{const r=parseInt(e.query.limit,0),i=parseInt(e.query.skip,0);try{const a=await Promise.all([n.findById(e.user._id),o.list({limit:r,skip:i})]),d=a[1].reduce((e,t)=>{const r=a[0]._favorites.isPostIsFavorite(t._id);return e.push({...t.toJSON(),favorite:r}),e},[]);return t.status(s.OK).json(d)}catch(e){return t.status(s.BAD_REQUEST).json(e)}}),t.updatePost=(async(e,t)=>{try{const r=await o.findById(e.params.id);return r.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{r[t]=e.body[t]}),t.status(s.OK).json(await r.save())):t.sendStatus(s.UNAUTHORIZED)}catch(e){return t.status(s.BAD_REQUEST).json(e)}}),t.deletePost=(async(e,t)=>{try{const r=await o.findById(e.params.id);return r.user.equals(e.user._id)?(await r.remove(),t.sendStatus(s.OK)):t.sendStatus(s.UNAUTHORIZED)}catch(e){return t.status(s.BAD_REQUEST).json(e)}}),t.favoritePost=(async(e,t)=>{try{const r=await n.findById(e.user._id);return await r._favorites.posts(e.params.id),t.sendStatus(s.OK)}catch(e){return t.status(s.BAD_REQUEST).json(e)}})},function(e,t,r){\"use strict\";const o=r(11);e.exports={createPost:{body:{title:o.string().min(3).required(),text:o.string().min(10).required()}},updatePost:{body:{title:o.string().min(3),text:o.string().min(10)}}}}]);","extractedComments":[]}